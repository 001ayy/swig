<!DOCTYPE html><html><head><title>Coverage</title><script>

headings = [];

onload = function(){
  headings = document.querySelectorAll('h2');
};

onscroll = function(e){
  var heading = find(window.scrollY);
  if (!heading) return;
  var links = document.querySelectorAll('#menu a')
    , link;

  for (var i = 0, len = links.length; i < len; ++i) {
    link = links[i];
    link.className = link.getAttribute('href') == '#' + heading.id
      ? 'active'
      : '';
  }
};

function find(y) {
  var i = headings.length
    , heading;

  while (i--) {
    heading = headings[i];
    if (y >= heading.offsetTop) {
      return heading;
    }
  }
}
</script>
<style>

body {
  font: 14px/1.6 "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: 0;
  color: #2C2C2C;
  border-top: 2px solid #ddd;
}

#coverage {
  padding: 60px;
}

h1 a {
  color: inherit;
  font-weight: inherit;
}

h1 a:hover {
  text-decoration: none;
}

.onload h1 {
  opacity: 1;
}

h2 {
  width: 80%;
  margin-top: 80px;
  margin-bottom: 0;
  font-weight: 100;
  letter-spacing: 1px;
  border-bottom: 1px solid #eee;
}

a {
  color: #8A6343;
  font-weight: bold;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

ul {
  margin-top: 20px;
  padding: 0 15px;
  width: 100%;
}

ul li {
  float: left;
  width: 40%;
  margin-top: 5px;
  margin-right: 60px;
  list-style: none;
  border-bottom: 1px solid #eee;
  padding: 5px 0;
  font-size: 12px;
}

ul::after {
  content: '.';
  height: 0;
  display: block;
  visibility: hidden;
  clear: both;
}

code {
  font: 12px monaco, monospace;
}

pre {
  margin: 30px;
  padding: 30px;
  border: 1px solid #eee;
  border-bottom-color: #ddd;
  -webkit-border-radius: 2px;
  -moz-border-radius: 2px;
  -webkit-box-shadow: inset 0 0 10px #eee;
  -moz-box-shadow: inset 0 0 10px #eee;
  overflow-x: auto;
}

img {
  margin: 30px;
  padding: 1px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  -webkit-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  -moz-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  max-width: 100%;
}

footer {
  background: #eee;
  width: 100%;
  padding: 50px 0;
  text-align: right;
  border-top: 1px solid #ddd;
}

footer span {
  display: block;
  margin-right: 30px;
  color: #888;
  font-size: 12px;
}

#menu {
  position: fixed;
  font-size: 12px;
  overflow-y: auto;
  top: 0;
  right: 0;
  margin: 0;
  height: 100%;
  padding: 15px 0;
  text-align: right;
  border-left: 1px solid #eee;
  -moz-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-font-smoothing: antialiased;
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGYAAABmCAMAAAAOARRQAAABelBMVEUjJSU6OzshIyM5OjoqKy02NjgsLS01NTYjJCUzNTUgISMlJSc0NTUvMDA6PDwlJyg1NjYoKis2NjYrLS02ODkpKyw0NDYrLC04ODovLzA4Ojo0NDUtLy86OjwjIyU4OTosLS82ODgtLS8hIyQvMTEnKCooKSsrKy0qLCwkJSUnKCkrLCwpKiwwMjIxMzMqLC0tLS0pKissLC00NTYwMDIwMTQpKysoKSovMDEtLzA2OTkxMzUrKywvLy8qKyszNTY5OzsqKiw6OjswMDExNDUoKiozNDUvMDIyNDY1Njg2Njk5OTozMzU0NjY4ODkiIyUiIyQ4OTkuMDEmKCowMjQwMTErLS4qKywwMTMhIiMpKiopKy0tLjAkJScxNDQvLzExNDYyNDQmKCk5OTslJig5OjskJSYxMzQrLS8gISIwMTIoKCk1NTUlJSUnJygwMDA4ODgiIiMhISI8PDw6Ojo5OTkpKSojIyQ7OzsyMjIpKSssLCw6Ozw1NjlrfLakAAAg2UlEQVR42jR6i3ea6rYvPgANIAhVXh8WvkQlioUiFlFcBtAmoiRNdzxqu9p0J7vrdK29zuPeex77nnvO/35n1r1ndHRktI0jTOacv/l7lCBK5UqVpOha/YxmWK7BC4TQFKVXrbYsnimqxuuMVlOQ0XltWjUdCwRJ1M+tC1KudOs9q6+da2adUewG0SC0SwELfHtgDds93VEuydEbl3QMWeNoYkR7b/0x1ZRobGI3mLwzAhePqTAwhg6aogjNsGy7/jwQ4rkdqe7CWLxF8k9LfMVFyRS7VJqtkrW8Vt/bkR8FZJao16ipknbC3Yw2lM7laO6HBEOadEZ2tpf65c4v8e3u7FyU6qbiNNyCuzXZ6pawgnwgmrpTT/Q7w2EZmiIJ0dzWDI7mhQ80IfRnMu2kzA5r5r1pIFoia+/d93HRYp1GV8TbrkWoU/+jdI0Ff6yGwTjT1Hn8J+8m1rKpGiYPuNiHnMtNMIv+zpsk84MYTNW1/+DpwXLvckdOCMYowVNPREe0QlM8xRHXXFhcNDzupwsSmb5pH+0t0RP2Qk+QtI7F1Qm6JRC6ZPBtPq/dq/kH+jxtCljn9TIpW6rQIgmSVyj6lPICIw4N/taka41PFUInth0je9+jO6Kt1G4/a7V2LEgG02B0pHVuCZrgltSKMuIl5SyufUv9mYuQi+mFgzbBEtFo2g+Dh4sSTrLNu8JPh00sQydpb00tqXBvqRN7Q7kqzcnIxCGnvZt/WmJacoOEO6Dcn8Qre03pOCSQxbMOXUuDNx9SxuLz4W1I18gvjViQ67zV0rxdWL8Te/TQkuo8STS41DR48W7L6YP2uWIqiUV8rd6Gbf/rnegKZeG8TpAM6afhGze9JAOxbLjsnUXEbrZ9vLYd7MT32cPF5mKKxmjy7huaoD9n62GOxni3iIJwv0IzZAZjdZkUtolCNLVfYZNaquFjGszVVf+J0vrz4CawoKdHnOzb0NMH7CDBOybfYNJ4rfeMyFNjkFYVTzMFs87rnPGXLUOeNKRVc0LnU7/UIgelzsy3CMuth0YfvnY0wsD3vODUL3eJcKqHQpm8yM3XZQWJxO6Un9iYloyyLpOwN2obHy6W6gbpcb44XmyC+mg+itAcaprGcrwZCqMj/GmtKn0zPvpTz/Cv1dw21XwP3cRupg3H3MF/S71eTKj1YrdwKdc2Mw0fRmb2sFf8lW3aU6JbIZSEPqvXvjM7G/aApyXlXeqKfMq0g/Su3rUGJPSPrtGElgknrZM3xUXqsAP6zMCNVn5u8aJnSNpJv2uru7t2jfRziW2+GuhqfldUNbPk71olwo+46ePUo1U3WKk/e5YK07F/wGRgcpODmQnIlVeHCWBE4puBi2jq28UKpqiN1/4UOrGz59TNYrrQHtd+11sG40BGD+pXdelNqGOg4NXe8W4eacJV/NS9/2Umtym6WQqveqR9xdCMElpxnbkalM4Vf9uaEcWZaKdyibEIjWKxJZPN95niCL3GiaXyssIrHxoLkqkzLCXULN46/f2h3tQJgyip+Tk9EAjJ9aJshq7t8X45aowSKspMSvPf7r9R8yxNptIaHS5ozuEm6luPDApugyNP8OaqiQ4BjaequXA54SLC83eHIY2r+CZp4409Xqw8Aa2oI7XkCrQi+in0w5AqF/kLNrcUz+qkl/lAobY1jSnx5OJNhyXIz3qfNFlXc0TKaglNwdWkWYt9QQ1Kr6W8zue21iNrdJk+N5oCr2O9nEtWKC7IS5J/zdDEYrmnAYfg6agCy+qcgz7ZofeDc4PbUWSvkshWuAc7OjiUyLkj+RAtdlwXJcjxdpkTTHDhK8lBCi8+JtvDVL1W6elmOM++YS0LuSlaP1oUvAeiW3cFnvTr8EbTz1tsSMYdGeZe40sRWu5uAfj7q+ZoKv2FNQ0p5XY1lmlcigHZqTPpabufEVrNuNPi165w3uCVQJHyJqmSJ7ZHnguqwtCmwViIJijj04ba2JNYtB+yORf5gg1/9t9iw4vUpeqiunSAbf+IBdj/b+iG2qrHvuNP0Vd/+ThVZT/lrvHYjjgDbbyxaqgHNM2uhxa1GW3UedZYhMMwM4mQhltouK+IV4NdbIQNM+8Yv311RZk9kT4tiYR4LkyFcuPpdcjuhUuFqBAWRZa11lcZ3gEBlXywsNhrt+plISZP5DlsV9l4EgY6J3yZPTUcMrgaWAT3oI79eSbGEbcJpr6BD8kyDiVt+G0/hXosQN4NFXKlfWIfsIs0BHODVok1/IGnKFHJYIquh8Xo+2+bkQNTGgWmN/fZ0Y33LSj6lr1GyV7mWIKg7ZTRZPGuhF/zjRNcQ1UPtSYgnWQxSs0yrVhwNDcdGMNSNe2JT3WuzbAM3HykyAajS3Uphf6STKEqxLas9EnmnhA/lyj9Uj+JoY7SVgVmGLl46Rm2u98sbkap2lzAdKBG4r6LgulQOSSjQv1GWdQ0jtDUK/mAaqM1Uqjpu4k3Rvfvxv7YTxLSK+wN3E5jVIzmF23uZ7hiH/sVP49D7tvoKp4S8b1LuvRlivVB/algbhcFITYVXvDpLzpDfplR2uD5V4XJFxpjmIpLc9Y5sB2TpBRix7Bme6GZIq+06v3XzNeTcA4obQIKxrnT4C2JpOqD92dbmSX8MGazly5EsZVMvSU1f4RZwyu8iQXbVdeLlZrjuTT1jrY1uk5c7iZ7RsvhhluqAkq4JpVQAg7RJFtSu+xgJ8Pv6O1j5DkLxT8mkbfyRW5DrQmG7hiDIjCgBsADbjuof6YHLGeV6a5Q1Smx9joUXPpdaaDx97A/Wq00oJkdR7ZYuQRfS533JtxO1erduqWOYIt3wh0wpbLuCNIYkwxbswbikCUu2CDCS+Q+7rgVtfRcm+SOcdKPRlZ/rE7wNVUEE39KTS5uvUKN1PUnkloPkyzhyGQ8qkouEjJ3H/VXdqG6asSRiw3ecMlBvDDt8dDhBHXMwZ2Cajzjr7/76T+IavqPYvz6r7//E/3X3+N//h/0QozbjPgPiir69P/8X3/9F/yv8b/827/++98WItPu5/Hvwd8YPf5bp/2/lX/T/+Of/0MJ/lYTa+L/Ef+d9vN/3/2T6P/+jyTzu/evf6U7vxN7B6pJkRtAF6jUr8I+P8RsP/ptGhfqFk+pQ/DgAy6NJtRYJdXmp4gK7WLqLKJ+MaKhGjOojvL+SnIWrkpy0SLHDe4QuyNzaEA15mLMCcmE8Em+4HdOihW4/ZWuppJEmzeAwcDtv7MuLc9y2V5atvxXNe3S4DUMt5/Qy2LM9kSYKiVWBuKlfp4nxTntpuW03JbIlkiRvBXmT23g1I2OYe6IizUHPIq6zm6mbfsbteKmi/sg9J+ocQBMctGFO7iljo8TPN+z3jxw4do+ZwfqoR9dkNTKHyM305GpTkfhcHexVkPVGEbUOjuo9f0UMPHBFlGEx0SLvJvVRKTwW7PSew5oPme+E42+frJa9cGt2njS3dK5kIif2eYbhuSEQXEqMVfUjhGIuin0G0/W5ezJyJQy3SpMLai4M0JUWb5u1k9tny5bd1pPwYBpQuDCXZl62xg4CdVEAtflXHs6JKmP/pH6mOl796Lgopj0o8d5kKh00hxG3OSdEE/QBo9Hgr8JJqAeLDwJohG5j/DGh61Rc/+tf22/8kEnxHNCEjo0ElvvGfESZkqmz2BDcKV1H1buSkhkdg7p1IMGs2s17nYjpblrWuE2K9WEO/hcRp5e9oOF/QBmOaDtgil+oaU6szPrdwW65fOB0KUTsVUn7LFU7J8e6cxJIl9+FHw5MQMzuQJ+4oxMH3iW/5GK+hWuG0T+gTLs+fAjdtUd58TmIUq04EeyRCYCjkldow234aIgR5bqwrtZosZ+6YEqAmDqatJ9lWasz4IquKALPtd92hGI3Z2BdzzZue+REl1Om4DIWD+RrtUTOJLI+S0jHowXXdAxsGLSd40zYNuEUlOGhrwL6c7tcOtUOvpJCP7QBQS19H+GvZn05ewjlVLz+IGKoC9TyfQjLMBNmXCuqqtTdOSukZW48B0HqgSTCBrBnlFvF4CG2Su7yFzqmJFURK3UmTT3ru050r0ptUpMilYnBJWfl2Bv6kPlUuE1kxxpdzui9AubsR2N2boVSu81OulAwBqoSr1LZ0LLYOomyZHmjqnXlP72s8LnDouEJjtodBvdHaG1jMySYO7crWd90MpCRyCG14vb5IE7Arupw/y/RcCm/Tm3zK6zYj8PYNaGldiUfkB/LHWcmf2lVM+mwyU27a0qq2tscrQ/vzBjN26DnntIrOyGizzXK35yKQdYnUABkyN4saz3WD/viF+eCcsXnIajdWYJWaYHRstIis9CS+tqnFGmz2j5uzfr3Z4prqgK4XOT/PyftvjZqIm8lhkfxJ7Ol3CJF1piYBGAG8wtAk56Drw1YwmOpcz+NdfkSpSLplRXLXHL0Rquj6YW/gabqgK7Dgr6NwtH0B/AN7XrN+MVJ6AmXmUuqmQulrNNYPmH0RoDogydOKLo/QbfYNARSQQKISRCzRXU+q9WWJFL3LZW6u34CkeG97xC0NNGaJ0bvK6SnZS3zPskr5EtuCgjMWR5o2x5BqhKmDWJPRe7JMEOyRb5uUKlHaGVtq5ivSOaSliSXp9SQm2qk8MRJh10MAp9QQ2H5t59J8rjiwSZtoIfMGjlLPVNdYl/LBR0AO6WLGDmkLkIPRE45Y9MftdAK/yNu1Hn6tzOQTesgQ+8fSzB19wO91vCnO23vOWQdwJ63SJrYjdfKFW6W281PKs2k8iT9ai1cgJ4sa3xqdvmtxR8/+D1B8AKc2u+6JftryRhMWSQtoSBgIyyQGyxcnELuAasXN12oSriU4RMz1DD6RL0TSV+om7i1Yt+jEE/jnawM8cX/UhN4nkiv/w9eALrzNhXuQfOzFL0Fi6SjF7/4Qn8rLYBoa85cvgAnkCEBP+HPbEnquVXCZsMS/yzYw2Vru60P/+nJPYKkzZFjmbykzUoEqV836T5q3fP/L383dF82tx18/AZgZczMAgyeWYKmSZIqtHL+e+O4ZRcq9VI3g/qPeCoiK4pcgEqdbS0S/Be54sbVQOuJVPNBblIghzeasNu7h/g+Sz1IdhI5lCwq1nUb3Ji4OCIcqQZqtqJ5w7rXrg/DA9IgVmEGhDgGecEwnCTHffXcXs0V3OCEVzYDKS1vp/oX+ng+6XVU86UjA6FMO2RXOOOrqY1GgPvrAk9HV/BXtCu5RuwF8qgdGDLsBcui4E33ymdBip1X8uKyhIWT8qNRDsXz+gvO9UiEC0d8RG4Tf2x8H4slljgHtCBcxHLTWOYJm5H/fCPCzOgf9qgOUxTRZ0Pc6ha5yLuLVT9ntvIa6gacE99mCovdUumTQdRP4RPsS9129eEe2uSvvGh0bV4Y3QPPhPZMqhZWSMa5R0Hc1SGO4IVOQc0FrirlibTVfKRrYkD8kz3b+X65/QkUNaZdrdl3mCap0Hf3YcCw/LiouJYNbqz88UqeDYv93yO7vvXtgl4XCyAO4ODkY6W+83+LZU//p3/zXNGGrUKClCiOnL27iJZbNWDF02XXAOeFlB7IaADoMH1Yqr+UP9biyZDEa/iJt4MDeIz6GKTdLVBfWGVtRN4fdT2rgReX8UXwF2zOrradm4J0nyTgdPnai3RvzpZvCKDUqjOwD/QA6EDaMCLewX6QWYVnHY1sx1bd8ovYnPm1ZvPH+rE20lWjOCnZ66/xDt0QAl15FjfBcZp+i9OU0RNPQ0t3x2pSNWo8eiYudwsnuP1Hq6iH1LJCJynkYsfgJ0p3pF6SoQk2l+jqE8CPk+ziGJRSKjs+W5AO185umPdkYzlK4wl7TC9NxyyDP7ZoyYVoXiuS6SjnInlLWrwz1i8bGTKXX0AVQWkSfIlglW3zRJRJ8bg5VgE6ZEnqNu9B++0GNQvDQJvFize4ESNKBJP+8vA3LM4AX5SIBq08Mob+7QMTCZx4nwP/64+4BnlZC+8WtlP/CXw6t1PwMwkJ3jhP1FiXLhDF/3I6FGUzO2DSi9ABxKyyL9paZxSEz40ZCPQToDAJu1959k7QdbVxgB4icsu2s4zsTPJhcEDo+N1GX4zSk/wriRh8AqwL62972i9HJHd1ydaLXVzvKvOfGGw5RVcUVMiKXFH4APdkQU/dc5BX0YfKTNZYXCW9mb8bc8mufoQP6BbdQmT99ZjoYfr/go4TgQX9IDgztim7wyFeGMfbNaeqj8Dzs38pgcqwSv2hbqB3oSGKWKy+sesY7p57wAHldqE6NDudk/W7s/zjrK4rZFlFvaGxnSZdHbc1y47qDN6xkoK8O3bfr2j41dlJZ71rB4dlDqapPFa8N6xBrprUdtenUCHwxKNhw1uuTBh+9uU45k4REpQABN2bAO9DSLqoIL26gNroWgup5pUMxHUNSq4Gyz47vBPvilpo5f9OYI2ddAqTqmnxXERxQJ3UK8fHbVE9HagHi3+tqNRoNsArdmAxHA5LwtQo9ZAaNKUTljnokljo2x8scqVpEEIPc01fPCdHOCg0DeWBz8D5TVAAfx8aRH5X2ZYNI3ebKDZdeJ+oBDAxmRqJ30Eh2/DaeAy5diVNMpEDmXiPDsGTzBLXy8eVDdJoIafgx/gxMyQi454QrW56nCyeELgSuNNEmYkflF+t3CZQOVRWjKhIuCclmQSlAXT3+4JGG75B4t/5hQ+ldMP4LsAW6z3XmU6IJJwpnGVnsgUZhoY1fZlwTR8wSU7xRejf2uCx9Z5trVTRRJP9KnEb134dEieil6eCOGWgboI7xsqsqM99jfJLTePjygKlH2CVxxsse9QRzTBFjD/Kjqitr/CCTBt/SJ6nLxz7cKP9pFqBpp0lN5y+adKNsZjrPuroemZauH9aTTFD3EKHW8S55XBLFQAt1jgxTQCTwxmx/JyfsZDN1RroN3VaxpSenpIX7K+ZbL8VdlQDcI4Cbzg3QJLa9yVqNxUelu+EtxLVqeekaAvSJkO6sSVqbUajxqhKshNpvZqoeApF0k/0P0ikkwUcbdwc4A1ejN7Oo0O15kG7hTMoK3hZRBCX7YYeLW0wvcXx/18n/u37yLgzBYVBUvORGli+sfRcX/74uD6P4hq+7xu54TlWJLFzT63uwUDwuEDdOjJQqx7JV+ZjaEAPi7t0MMrR4Q8Rkf18uxD6RK0RKh0hL8YU+DeL97i4pa5ZSyAfXKwZRS/8gXcxdZXm62RBDj8U3sN8x95b5PpPs/mCBKYvpaA50pN5Ct/499AFTtwQ5vgeSh+NHrKIi4NVpwM/XzRaNfJD856lPE6M21zWPguFsH7jbLVyEDfRmt4VwrhCJ5VTYmcSPfGgO5clfN+vbaDZ7sakU5+2vZ2WCDY031NxJarVytfDDVtiafcTGO2rJ/taoL3zChN2qmjxofczTOYQPPVQPh0JVtYgdUQINcSiNEEy58UdYXX1MpWUCEBx7LbcGtAm8XWRQTVOaoV3ySri4RShhs/B/0m4jX6OAwXOvcA09bNSG4czEGv/Wey6V/jbTCNTW6awXdNTcA1GsPe1E9fZdGl7R0vyoVpIdJtfC6d32NNErrvq/R+d65VG+YOwRXppXxOCYyGNSf1K3x6VxAW/vtz4EC1SgCOSPdN62sLsoIzuDfg8GwZAbquVO8HIuFP/ToVoeUB7nnwMF35a1wK1tI6fkrqFKhQdeJpwyls0pIy8AZde3/6LUUbFaYJthyUJSU/kqDXTLQElnn0Jr4B2RVghNrmNmoEn7pXIeshPguXVsvwoTdmClq49JJU3LWhHyWTrJL9bRP6VKv3tZoA/th77p5Jw++OEENvyvWy/pNeExiDUVQaXIRGh8xySZTI36yueFaSXo1uJY0RnXYgEOoWWOJHeaVuX/bGNhHsh2yinznl/++NJcE9j6fBPRcBdq9hb8awNw8U7Bl6GM7x69EDOIIbX/npZ++amlHR9L/35mE/2Ss4gb0xCcY4VyTFLRE796vHysLAamqcyO+aFQyJIDBNslbH2/MrAvZiSEIedc/cqjmv4fbda2pXbv+F5a2szSsdkm9noiNURXt8edUhGUF6fSZWd1IJaXKFwD+49R6eCXD4Bkef7j9tRtNMVgW8BhRz/Qpy1TmeYk0doyjZoJSbePOReVHgkFsCFuQJ+Lgc4BxeAsK/cOiNDRmdNw0ctYhn/nQ498dYI5znzGLoJi1rav7Cn88rL3wLePVtDK5gl77Tki3gHEsIAQ2+IKgarj7Y8W1IQzV5V9N+0TjLqbg68WfKcOmBCOj3JkwJhVIkwDhc+JorXuZEPMEh0vvH3x7iqf+VAwXgd4diZiaJD1zHL9Snx6Wfg4IugreyhabQkcir+y5XgDtdx3Avs7lkeeCBwDvZoTUCXx5QrZkcEqWfYEiEYRs/EphmRALSNGR1Iclgdr5VFoELpzF4++f35w3/j0t5ucW3n2ch4PQCLuUXupsPRR7UA5FjSKrMtPcKAZJfagO4lGE7FH3YKMjorpK0ZxAv+i2JkJhtAMWWWFej4RhPR/cJ3DxwocCvXDi4SGZU4cu+K32XndiFWgopAl+0GApcwf1XvymJcFs39jExIBO4yUjU9MExBLQYc9H+W7+IgdESPRpciT+rKZPebVtaVq+1GYO/5xTAL3HASjNTGIgMvdjWbgc7JvdE1zIFpuC0U9ESiZyzBixzxWxj4Kwh8My34q+FK3KNLtmsA1qyrmKSNQOXCPUZd+ONelBTvFoUI/CYsqa/RhtKiyMf2CgSFqEPk59Y3uqnlZ8gFpswfSYyko23yVZYxzKGxGm49Zqxg1l8oz5Ra9XaRwHkuxepmgyhm0SoNy2KlbcEqK+9QqS9PNx9Ihm9U7gsR55SSJ1FBDNnkuWKxIZ0SDpXuOGwZdoUbOMDPHP4vBAgz2VlSEJAHZGJVbYIg7l/FO5KfIVvxC8pPPxMGcNMoevFDeStt2iqztE10n2TA4dgJH76YS9HDhKHD3iCx6ieFX84BAI3QQnngh76f5ruPQVbr5qZmck/5UjDc26lfrOvUBWy0Ogl8bCoOkMOns81TnC3cuUS9KW8+9A+fe3XYZOFUPG1u5epSSmDLw0s5s2F0W30ANeo+zJkJQz9SPZgzwYpEoktofhGVfmLOAB20boCbW1QWq/NpET/hnMecw/uSyAH4NJc3ECOU4nnkK1fj3S/i5dwb3R7k00AqQQUwt7Ie1qV0aY/VQX0J8hLPy7eBNXMHYZYDNxHZ2Qh6AuXJxq+AeRec/Q+JLhZV6hpXwQEzw7bf5v9uUf2vpq3qlhmy0IIGTkwYdCfSAFmqbdo+3XvDTDjFJde0mbeQLcn2n31xaAqJ0ixO/CLsT4I4G4DoncVTgRGNBtsCcjISWT+oeXZ4Iedw/8OsJI1aPnNKLX/60VvcZb94uasRxCkqlPQ11u1Sa2hHvB80WQENxVyzjns0/PiEByyil21Te6oisk3mNCEMrhouCFO3yEZTHHOCMy9eb/4Tmi8cVf3Lf7P53SY2hX3PSN033As3ETIMLHWumWEO9JXHA2y2SIBlIPpLGG2qvNsCIlIr+B1SWAqRKm2w6Blf7U+zCSBwJrfHG5i8J5Gax/cVonMlon7aHJX/gSvucIncRP93XCqkv7D8IFKFsLiBgHqUpXhE3pYjEcV1dk/JD9zFVCfEaQIVX8Jmfz7IIofcBKQ4OaG+C3xC2veX9CD+iAFXDNaGg9eTVxvkbJRJlW4Nk9Wk13kn696jWppRDe/8pDrYMO9ZyxZ98ReKSz9kWKLLyk2zCZgAniCkLJVX3n1M9DYbomyahWiv/KixRIV9hj/oFz87I+HLznbPTjpa+D+bZQnMuRsljTpv90vQUt/pK7jCFnA30B/jtroSF2/m/gpWn1aQs5WeA6ghzF8SdqWI20fghdSeDOCSCmLgTkfaGgGDmw7nHFkRzGtag57IHS2na06I+gzEphXo1w/Zx2BM/jKL2nZoFjHggtFQjYi8nSVRSXIE58RPbBObXk7uuIL9+rs/5Zo7suJInEUxgsiZZAWS25iBtpEiZeBgDtghEoAE0sjcayNq85M4tbu/LF5h51335PsGzQ09O875+vUS89lkWMyNOFoip2PuyWyMP/iU2XIZdfCCJNDjebDoBLQdpy7QQZC7s9c0wjHJervQNDu2jWzBW5MSAJMr7bP+Iv92BkS/GGgzjEn7MF1IRKFwwzbjbS4/slGOmhx9cZrFu7HSEefojNv3r0UaKfKOWzXsq1zEugbzlMDFsacRJJI/iJlK3vtkZ+PLZIVMFlKA32wbq2Kd5T0uCLZ1CPkAfCdzkz2EYscjDcZq2AWfziN2covN4kXE1lQXPPLTNM1xx3tbiepcO/t3SWm4w87qfh99SL0ZnY+LKFPLPeXVM2mIIoVWt+9Nk0I7nY4O79iGYqxZ8RVz289an6NVdJWnSKZvJQCAuHNiVaDxPAFoH392t9wot5t0/qmU95eEWNbU2udUW5sN9JVqcYlvAIfLeYC33oUzzxZgSktsv21mA7Uly1FA5VnoJFh6N244Wmv3YJGFv/TCPryaw+ZORlpZjQdq/2DYXr3EZskfed0G61P09ipTKmlTQ1067Rg5+PAk5FlQ9e0SWbGf2B/08kqymOTMVOznsALHHNFH4LFRKl2F/NOiYFl9khNHnSu9Ak5sq26Ynl/i2fdTle29Y1ugqmR5Yj4YT9pvslFyYCbw0mNFr5rVQm1LvkG27QMq9ph3t8fmn6r6SQ4oSbr5tz+J1kIawGzDxb6VYOvvWhobDTXfBeNv3b4aNm5XUinsCGqG2q/45m3+LoCOsddFceYhRx1Tsss9PLdPfJdErFMjYd3gddjiP0+XQjcRadZP6bwNLySvunFf20Czy6JqdEW2a96KxdYdOryBv1BjbuUq2yCHeh+6sk7fGmmPi50pe/1l5TyPe5oHW9oPnhPswLyf2TFDdCyYlhwBCstv5C1HwlW7xWoGT9XZt4qVj5WryLPLLD6h/5cMLEjWzgCeAIKNsLak92aBqBsHl4AJwl2N4jfvbSkBExGimv0nFvv09uDScQbjx+w4kPQjgjlW+g9ws9VEJvI2k8N6XxVu0uIwovgTFdunG24gBtaDi+y1YLQwZ8mwbip5fVlO3k0n0AEr/ETbtu8Vjkm+nNSiEb7X/3fMjBL5A8PdgG+/FnbexbFFExmEfetXAnisEKy5z44WVPpQZjSy/jzeGn4yDRsFGqhh87QPaDBWhlo37IFbe/C0xynS91d2tP/AJoJS0sVF6iwAAAAAElFTkSuQmCC");
}

#menu::after {
  display: block;
  content: '';
  padding-top: 80px;
}

#logo {
  position: fixed;
  bottom: 10px;
  right: 10px;
  background: rgba(255,255,255,.1);
  font-size: 11px;
  display: block;
  width: 20px;
  height: 20px;
  line-height: 20px;
  text-align: center;
  -webkit-border-radius: 20px;
  -moz-border-radius: 20px;
  -webkit-box-shadow: 0 0 3px rgba(0,0,0,.2);
  -moz-box-shadow: 0 0 3px rgba(0,0,0,.2);
  color: inherit;
}

#menu li a {
  display: block;
  color: white;
  padding: 0 35px 0 25px;
  -webkit-transition: background 300ms;
  -moz-transition: background 300ms;
}

#menu li {
  position: relative;
  list-style: none;
}

#menu a:hover,
#menu a.active {
  text-decoration: none;
  background: rgba(255,255,255,.1);
}

#menu li:hover .cov {
  opacity: 1;
}

#menu li .dirname {
  opacity: .60;
  padding-right: 2px;
}

#menu li .basename {
  opacity: 1;
}

#menu .cov {
  background: rgba(0,0,0,.4);
  position: absolute;
  top: 0;
  right: 8px;
  font-size: 9px;
  opacity: .6;
  text-align: left;
  width: 17px;
  -webkit-border-radius: 10px;
  -moz-border-radius: 10px;
  padding: 2px 3px;
  text-align: center;
}

#stats:nth-child(2n) {
  display: inline-block;
  margin-top: 15px;
  border: 1px solid #eee;
  padding: 10px;
  -webkit-box-shadow: inset 0 0 2px #eee;
  -moz-box-shadow: inset 0 0 2px #eee;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
}

#stats div {
  float: left;
  padding: 0 5px;
}

#stats::after {
  display: block;
  content: '';
  clear: both;
}

#stats .sloc::after {
  content: ' SLOC';
  color: #b6b6b6;
}

#stats .percentage::after {
  content: ' coverage';
  color: #b6b6b6;
}

#stats .hits,
#stats .misses {
  display: none;
}

.high {
  color: #00d4b4;
}
.medium {
  color: #e87d0d;
}
.low {
  color: #d4081a;
}
.terrible {
  color: #d4081a;
  font-weight: bold;
}

table {
  width: 80%;
  margin-top: 10px;
  border-collapse: collapse;
  border: 1px solid #cbcbcb;
  color: #363636;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
}

table thead {
  display: none;
}

table td.line,
table td.hits {
  width: 20px;
  background: #eaeaea;
  text-align: center;
  font-size: 11px;
  padding: 0 10px;
  color: #949494;
}

table td.hits {
  width: 10px;
  padding: 2px 5px;
  color: rgba(0,0,0,.2);
  background: #f0f0f0;
}

tr.miss td.line,
tr.miss td.hits {
  background: #e6c3c7;
}

tr.miss td {
  background: #f8d5d8;
}

td.source {
  padding-left: 15px;
  line-height: 15px;
  white-space: pre;
  font: 12px monaco, monospace;
}

code .comment { color: #ddd }
code .init { color: #2F6FAD }
code .string { color: #5890AD }
code .keyword { color: #8A6343 }
code .number { color: #2F6FAD }
</style></head><body><div id="coverage"><h1 id="overview">Coverage</h1><div id="menu"><li><a href="#overview">overview</a></li><li><span class="cov high">89</span><a href="#/lib/dateformat.js"><span class="dirname">/lib/</span><span class="basename">dateformat.js</span></a></li><li><span class="cov high">94</span><a href="#/lib/filters.js"><span class="dirname">/lib/</span><span class="basename">filters.js</span></a></li><li><span class="cov high">96</span><a href="#/lib/helpers.js"><span class="dirname">/lib/</span><span class="basename">helpers.js</span></a></li><li><span class="cov high">95</span><a href="#/lib/parser.js"><span class="dirname">/lib/</span><span class="basename">parser.js</span></a></li><li><span class="cov high">94</span><a href="#/lib/swig.js"><span class="dirname">/lib/</span><span class="basename">swig.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags.js"><span class="dirname">/lib/</span><span class="basename">tags.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/autoescape.js"><span class="dirname">/lib/tags/</span><span class="basename">autoescape.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/block.js"><span class="dirname">/lib/tags/</span><span class="basename">block.js</span></a></li><li><span class="cov high">96</span><a href="#/lib/tags/else.js"><span class="dirname">/lib/tags/</span><span class="basename">else.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/extends.js"><span class="dirname">/lib/tags/</span><span class="basename">extends.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/filter.js"><span class="dirname">/lib/tags/</span><span class="basename">filter.js</span></a></li><li><span class="cov high">83</span><a href="#/lib/tags/for.js"><span class="dirname">/lib/tags/</span><span class="basename">for.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/if.js"><span class="dirname">/lib/tags/</span><span class="basename">if.js</span></a></li><li><span class="cov high">76</span><a href="#/lib/tags/import.js"><span class="dirname">/lib/tags/</span><span class="basename">import.js</span></a></li><li><span class="cov high">93</span><a href="#/lib/tags/include.js"><span class="dirname">/lib/tags/</span><span class="basename">include.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/macro.js"><span class="dirname">/lib/tags/</span><span class="basename">macro.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/parent.js"><span class="dirname">/lib/tags/</span><span class="basename">parent.js</span></a></li><li><span class="cov high">100</span><a href="#/lib/tags/raw.js"><span class="dirname">/lib/tags/</span><span class="basename">raw.js</span></a></li><li><span class="cov high">90</span><a href="#/lib/tags/set.js"><span class="dirname">/lib/tags/</span><span class="basename">set.js</span></a></li><li><span class="cov low">28</span><a href="#/lib/tags/spaceless.js"><span class="dirname">/lib/tags/</span><span class="basename">spaceless.js</span></a></li><a id="logo" href="http://visionmedia.github.com/mocha/">m</a></div><div id="stats" class="high"><div class="percentage">94%</div><div class="sloc">943</div><div class="hits">888</div><div class="misses">55</div></div><div id="files"><div class="file"><h2 id="/lib/dateformat.js">/lib/dateformat.js</h2><div id="stats" class="high"><div class="percentage">89%</div><div class="sloc">129</div><div class="hits">116</div><div class="misses">13</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var _ = require('underscore');</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var _months = {</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">    full: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">    abbr: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">  _days = {</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">    full: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    abbr: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">    alt: {'-1': 'Yesterday', 0: 'Today', 1: 'Tomorrow'}</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">/*</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">DateZ is licensed under the MIT License:</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">Copyright (c) 2011 Tomo Universalis (http://tomouniversalis.com)</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the &quot;Software&quot;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">*/</td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">exports.defaultTZOffset = 0;</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">exports.DateZ = function () {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">62</td><td class="source">  var members = {</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">      'default': ['getUTCDate', 'getUTCDay', 'getUTCFullYear', 'getUTCHours', 'getUTCMilliseconds', 'getUTCMinutes', 'getUTCMonth', 'getUTCSeconds', 'toISOString', 'toGMTString', 'toUTCString', 'valueOf', 'getTime'],</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">      z: ['getDate', 'getDay', 'getFullYear', 'getHours', 'getMilliseconds', 'getMinutes', 'getMonth', 'getSeconds', 'getYear', 'toDateString', 'toLocaleDateString', 'toLocaleTimeString'],</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">      'string': ['toLocaleString', 'toString', 'toTimeString'],</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">      zSet: ['setDate', 'setFullYear', 'setHours', 'setMilliseconds', 'setMinutes', 'setMonth', 'setSeconds', 'setTime', 'setYear'],</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">      set: ['setUTCDate', 'setUTCFullYear', 'setUTCHours', 'setUTCMilliseconds', 'setUTCMinutes', 'setUTCMonth', 'setUTCSeconds'],</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">      'static': ['UTC', 'parse']</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">    d = this,</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    i;</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">33</td><td class="hits">62</td><td class="source">  d.date = d.dateZ = (arguments.length &gt; 1) ? new Date(Date.UTC.apply(Date, arguments) + ((new Date()).getTimezoneOffset() * 60000)) : (arguments.length === 1) ? new Date(new Date(arguments['0'])) : new Date();</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">35</td><td class="hits">62</td><td class="source">  d.timezoneOffset = d.dateZ.getTimezoneOffset();</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">37</td><td class="hits">62</td><td class="source">  function zeroPad(i) {</td></tr><tr class="miss"><td class="line">38</td><td class="hits">0</td><td class="source">    return (i &lt; 10) ? '0' + i : i;</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">40</td><td class="hits">62</td><td class="source">  function _toTZString() {</td></tr><tr class="miss"><td class="line">41</td><td class="hits">0</td><td class="source">    var hours = zeroPad(Math.floor(Math.abs(d.timezoneOffset) / 60)),</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">      minutes = zeroPad(Math.abs(d.timezoneOffset) - hours * 60),</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">      prefix = (d.timezoneOffset &lt; 0) ? '+' : '-',</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">      abbr = (d.tzAbbreviation === undefined) ? '' : ' (' + d.tzAbbreviation + ')';</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">46</td><td class="hits">0</td><td class="source">    return 'GMT' + prefix + hours + minutes + abbr;</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">49</td><td class="hits">62</td><td class="source">  _.each(members.z, function (name) {</td></tr><tr class="hit"><td class="line">50</td><td class="hits">744</td><td class="source">    d[name] = function () {</td></tr><tr class="hit"><td class="line">51</td><td class="hits">60</td><td class="source">      return d.dateZ[name]();</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">54</td><td class="hits">62</td><td class="source">  _.each(members.string, function (name) {</td></tr><tr class="hit"><td class="line">55</td><td class="hits">186</td><td class="source">    d[name] = function () {</td></tr><tr class="miss"><td class="line">56</td><td class="hits">0</td><td class="source">      return d.dateZ[name].apply(d.dateZ, []).replace(/GMT[+\-]\\d{4} \\(([a-zA-Z]{3,4})\\)/, _toTZString());</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">59</td><td class="hits">62</td><td class="source">  _.each(members['default'], function (name) {</td></tr><tr class="hit"><td class="line">60</td><td class="hits">806</td><td class="source">    d[name] = function () {</td></tr><tr class="hit"><td class="line">61</td><td class="hits">15</td><td class="source">      return d.date[name]();</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">64</td><td class="hits">62</td><td class="source">  _.each(members['static'], function (name) {</td></tr><tr class="hit"><td class="line">65</td><td class="hits">124</td><td class="source">    d[name] = function () {</td></tr><tr class="miss"><td class="line">66</td><td class="hits">0</td><td class="source">      return Date[name].apply(Date, arguments);</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">69</td><td class="hits">62</td><td class="source">  _.each(members.zSet, function (name) {</td></tr><tr class="hit"><td class="line">70</td><td class="hits">558</td><td class="source">    d[name] = function () {</td></tr><tr class="miss"><td class="line">71</td><td class="hits">0</td><td class="source">      d.dateZ[name].apply(d.dateZ, arguments);</td></tr><tr class="miss"><td class="line">72</td><td class="hits">0</td><td class="source">      d.date = new Date(d.dateZ.getTime() - d.dateZ.getTimezoneOffset() * 60000 + d.timezoneOffset * 60000);</td></tr><tr class="miss"><td class="line">73</td><td class="hits">0</td><td class="source">      return d;</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">76</td><td class="hits">62</td><td class="source">  _.each(members.set, function (name) {</td></tr><tr class="hit"><td class="line">77</td><td class="hits">434</td><td class="source">    d[name] = function () {</td></tr><tr class="miss"><td class="line">78</td><td class="hits">0</td><td class="source">      d.date[name].apply(d.date, arguments);</td></tr><tr class="miss"><td class="line">79</td><td class="hits">0</td><td class="source">      d.dateZ = new Date(d.date.getTime() + d.date.getTimezoneOffset() * 60000 - d.timezoneOffset * 60000);</td></tr><tr class="miss"><td class="line">80</td><td class="hits">0</td><td class="source">      return d;</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">84</td><td class="hits">62</td><td class="source">  if (exports.defaultTZOffset) {</td></tr><tr class="miss"><td class="line">85</td><td class="hits">0</td><td class="source">    this.setTimezoneOffset(exports.defaultTZOffset);</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">88</td><td class="hits">1</td><td class="source">exports.DateZ.prototype = {</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">  getTimezoneOffset: function () {</td></tr><tr class="hit"><td class="line">90</td><td class="hits">5</td><td class="source">    return this.timezoneOffset;</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">  setTimezoneOffset: function (offset, abbr) {</td></tr><tr class="hit"><td class="line">93</td><td class="hits">61</td><td class="source">    this.timezoneOffset = offset;</td></tr><tr class="hit"><td class="line">94</td><td class="hits">61</td><td class="source">    if (abbr) {</td></tr><tr class="miss"><td class="line">95</td><td class="hits">0</td><td class="source">      this.tzAbbreviation = abbr;</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">97</td><td class="hits">61</td><td class="source">    this.dateZ = new Date(this.date.getTime() + this.date.getTimezoneOffset() * 60000 - this.timezoneOffset * 60000);</td></tr><tr class="hit"><td class="line">98</td><td class="hits">61</td><td class="source">    return this;</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">// Day</td></tr><tr class="hit"><td class="line">103</td><td class="hits">1</td><td class="source">exports.d = function (input) {</td></tr><tr class="hit"><td class="line">104</td><td class="hits">2</td><td class="source">  return (input.getDate() &lt; 10 ? '0' : '') + input.getDate();</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">106</td><td class="hits">1</td><td class="source">exports.D = function (input) {</td></tr><tr class="hit"><td class="line">107</td><td class="hits">1</td><td class="source">  return _days.abbr[input.getDay()];</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">109</td><td class="hits">1</td><td class="source">exports.j = function (input) {</td></tr><tr class="hit"><td class="line">110</td><td class="hits">2</td><td class="source">  return input.getDate();</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">112</td><td class="hits">1</td><td class="source">exports.l = function (input) {</td></tr><tr class="hit"><td class="line">113</td><td class="hits">1</td><td class="source">  return _days.full[input.getDay()];</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">115</td><td class="hits">1</td><td class="source">exports.N = function (input) {</td></tr><tr class="hit"><td class="line">116</td><td class="hits">2</td><td class="source">  var d = input.getDay();</td></tr><tr class="hit"><td class="line">117</td><td class="hits">2</td><td class="source">  return (d &gt;= 1) ? d + 1 : 7;</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">119</td><td class="hits">1</td><td class="source">exports.S = function (input) {</td></tr><tr class="hit"><td class="line">120</td><td class="hits">12</td><td class="source">  var d = input.getDate();</td></tr><tr class="hit"><td class="line">121</td><td class="hits">12</td><td class="source">  return (d % 10 === 1 &amp;&amp; d !== 11 ? 'st' : (d % 10 === 2 &amp;&amp; d !== 12 ? 'nd' : (d % 10 === 3 &amp;&amp; d !== 13 ? 'rd' : 'th')));</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">123</td><td class="hits">1</td><td class="source">exports.w = function (input) {</td></tr><tr class="hit"><td class="line">124</td><td class="hits">2</td><td class="source">  return input.getDay();</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">126</td><td class="hits">1</td><td class="source">exports.z = function (input, offset, abbr) {</td></tr><tr class="hit"><td class="line">127</td><td class="hits">3</td><td class="source">  var year = input.getFullYear(),</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">    e = new exports.DateZ(year, input.getMonth(), input.getDate(), 12, 0, 0),</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">    d = new exports.DateZ(year, 0, 1, 12, 0, 0);</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">131</td><td class="hits">3</td><td class="source">  e.setTimezoneOffset(offset, abbr);</td></tr><tr class="hit"><td class="line">132</td><td class="hits">3</td><td class="source">  d.setTimezoneOffset(offset, abbr);</td></tr><tr class="hit"><td class="line">133</td><td class="hits">3</td><td class="source">  return Math.round((e - d) / 86400000);</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">// Week</td></tr><tr class="hit"><td class="line">137</td><td class="hits">1</td><td class="source">exports.W = function (input) {</td></tr><tr class="hit"><td class="line">138</td><td class="hits">1</td><td class="source">  var target = new Date(input.valueOf()),</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">    dayNr = (input.getDay() + 6) % 7,</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source">    fThurs;</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">142</td><td class="hits">1</td><td class="source">  target.setDate(target.getDate() - dayNr + 3);</td></tr><tr class="hit"><td class="line">143</td><td class="hits">1</td><td class="source">  fThurs = target.valueOf();</td></tr><tr class="hit"><td class="line">144</td><td class="hits">1</td><td class="source">  target.setMonth(0, 1);</td></tr><tr class="hit"><td class="line">145</td><td class="hits">1</td><td class="source">  if (target.getDay() !== 4) {</td></tr><tr class="hit"><td class="line">146</td><td class="hits">1</td><td class="source">    target.setMonth(0, 1 + ((4 - target.getDay()) + 7) % 7);</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">149</td><td class="hits">1</td><td class="source">  return 1 + Math.ceil((fThurs - target) / 604800000);</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">// Month</td></tr><tr class="hit"><td class="line">153</td><td class="hits">1</td><td class="source">exports.F = function (input) {</td></tr><tr class="hit"><td class="line">154</td><td class="hits">1</td><td class="source">  return _months.full[input.getMonth()];</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">156</td><td class="hits">1</td><td class="source">exports.m = function (input) {</td></tr><tr class="hit"><td class="line">157</td><td class="hits">2</td><td class="source">  return (input.getMonth() &lt; 9 ? '0' : '') + (input.getMonth() + 1);</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">159</td><td class="hits">1</td><td class="source">exports.M = function (input) {</td></tr><tr class="hit"><td class="line">160</td><td class="hits">1</td><td class="source">  return _months.abbr[input.getMonth()];</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">162</td><td class="hits">1</td><td class="source">exports.n = function (input) {</td></tr><tr class="hit"><td class="line">163</td><td class="hits">1</td><td class="source">  return input.getMonth() + 1;</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">165</td><td class="hits">1</td><td class="source">exports.t = function (input) {</td></tr><tr class="hit"><td class="line">166</td><td class="hits">1</td><td class="source">  return 32 - (new Date(input.getFullYear(), input.getMonth(), 32).getDate());</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">// Year</td></tr><tr class="hit"><td class="line">170</td><td class="hits">1</td><td class="source">exports.L = function (input) {</td></tr><tr class="hit"><td class="line">171</td><td class="hits">2</td><td class="source">  return new Date(input.getFullYear(), 1, 29).getDate() === 29;</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">173</td><td class="hits">1</td><td class="source">exports.o = function (input) {</td></tr><tr class="hit"><td class="line">174</td><td class="hits">2</td><td class="source">  var target = new Date(input.valueOf());</td></tr><tr class="hit"><td class="line">175</td><td class="hits">2</td><td class="source">  target.setDate(target.getDate() - ((input.getDay() + 6) % 7) + 3);</td></tr><tr class="hit"><td class="line">176</td><td class="hits">2</td><td class="source">  return target.getFullYear();</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">178</td><td class="hits">1</td><td class="source">exports.Y = function (input) {</td></tr><tr class="hit"><td class="line">179</td><td class="hits">2</td><td class="source">  return input.getFullYear();</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">181</td><td class="hits">1</td><td class="source">exports.y = function (input) {</td></tr><tr class="hit"><td class="line">182</td><td class="hits">1</td><td class="source">  return (input.getFullYear().toString()).substr(2);</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source">// Time</td></tr><tr class="hit"><td class="line">186</td><td class="hits">1</td><td class="source">exports.a = function (input) {</td></tr><tr class="hit"><td class="line">187</td><td class="hits">1</td><td class="source">  return input.getHours() &lt; 12 ? 'am' : 'pm';</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">189</td><td class="hits">1</td><td class="source">exports.A = function (input) {</td></tr><tr class="hit"><td class="line">190</td><td class="hits">1</td><td class="source">  return input.getHours() &lt; 12 ? 'AM' : 'PM';</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">192</td><td class="hits">1</td><td class="source">exports.B = function (input) {</td></tr><tr class="hit"><td class="line">193</td><td class="hits">1</td><td class="source">  var hours = input.getUTCHours(), beats;</td></tr><tr class="hit"><td class="line">194</td><td class="hits">1</td><td class="source">  hours = (hours === 23) ? 0 : hours + 1;</td></tr><tr class="hit"><td class="line">195</td><td class="hits">1</td><td class="source">  beats = Math.abs(((((hours * 60) + input.getUTCMinutes()) * 60) + input.getUTCSeconds()) / 86.4).toFixed(0);</td></tr><tr class="hit"><td class="line">196</td><td class="hits">1</td><td class="source">  return ('000'.concat(beats).slice(beats.length));</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">198</td><td class="hits">1</td><td class="source">exports.g = function (input) {</td></tr><tr class="hit"><td class="line">199</td><td class="hits">1</td><td class="source">  var h = input.getHours();</td></tr><tr class="hit"><td class="line">200</td><td class="hits">1</td><td class="source">  return h === 0 ? 12 : (h &gt; 12 ? h - 12 : h);</td></tr><tr><td class="line">201</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">202</td><td class="hits">1</td><td class="source">exports.G = function (input) {</td></tr><tr class="hit"><td class="line">203</td><td class="hits">2</td><td class="source">  return input.getHours();</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">205</td><td class="hits">1</td><td class="source">exports.h = function (input) {</td></tr><tr class="hit"><td class="line">206</td><td class="hits">2</td><td class="source">  var h = input.getHours();</td></tr><tr class="hit"><td class="line">207</td><td class="hits">2</td><td class="source">  return ((h &lt; 10 || (12 &lt; h &amp;&amp; 22 &gt; h)) ? '0' : '') + ((h &lt; 12) ? h : h - 12);</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">209</td><td class="hits">1</td><td class="source">exports.H = function (input) {</td></tr><tr class="hit"><td class="line">210</td><td class="hits">1</td><td class="source">  var h = input.getHours();</td></tr><tr class="hit"><td class="line">211</td><td class="hits">1</td><td class="source">  return (h &lt; 10 ? '0' : '') + h;</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">213</td><td class="hits">1</td><td class="source">exports.i = function (input) {</td></tr><tr class="hit"><td class="line">214</td><td class="hits">1</td><td class="source">  var m = input.getMinutes();</td></tr><tr class="hit"><td class="line">215</td><td class="hits">1</td><td class="source">  return (m &lt; 10 ? '0' : '') + m;</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">217</td><td class="hits">1</td><td class="source">exports.s = function (input) {</td></tr><tr class="hit"><td class="line">218</td><td class="hits">1</td><td class="source">  var s = input.getSeconds();</td></tr><tr class="hit"><td class="line">219</td><td class="hits">1</td><td class="source">  return (s &lt; 10 ? '0' : '') + s;</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source">//u = function () { return ''; },</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source">// Timezone</td></tr><tr><td class="line">224</td><td class="hits"></td><td class="source">//e = function () { return ''; },</td></tr><tr><td class="line">225</td><td class="hits"></td><td class="source">//I = function () { return ''; },</td></tr><tr class="hit"><td class="line">226</td><td class="hits">1</td><td class="source">exports.O = function (input) {</td></tr><tr class="hit"><td class="line">227</td><td class="hits">4</td><td class="source">  var tz = input.getTimezoneOffset();</td></tr><tr class="hit"><td class="line">228</td><td class="hits">4</td><td class="source">  return (tz &lt; 0 ? '-' : '+') + (tz / 60 &lt; 10 ? '0' : '') + Math.abs((tz / 60)) + '00';</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">230</td><td class="hits"></td><td class="source">//T = function () { return ''; },</td></tr><tr class="hit"><td class="line">231</td><td class="hits">1</td><td class="source">exports.Z = function (input) {</td></tr><tr class="hit"><td class="line">232</td><td class="hits">1</td><td class="source">  return input.getTimezoneOffset() * 60;</td></tr><tr><td class="line">233</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source">// Full Date/Time</td></tr><tr class="hit"><td class="line">236</td><td class="hits">1</td><td class="source">exports.c = function (input) {</td></tr><tr class="hit"><td class="line">237</td><td class="hits">1</td><td class="source">  return input.toISOString();</td></tr><tr><td class="line">238</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">239</td><td class="hits">1</td><td class="source">exports.r = function (input) {</td></tr><tr class="hit"><td class="line">240</td><td class="hits">1</td><td class="source">  return input.toUTCString();</td></tr><tr><td class="line">241</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">242</td><td class="hits">1</td><td class="source">exports.U = function (input) {</td></tr><tr class="hit"><td class="line">243</td><td class="hits">1</td><td class="source">  return input.getTime() / 1000;</td></tr><tr><td class="line">244</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/filters.js">/lib/filters.js</h2><div id="stats" class="high"><div class="percentage">94%</div><div class="sloc">114</div><div class="hits">108</div><div class="misses">6</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var helpers = require('./helpers'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  _ = require('underscore'),</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">  dateformat = require('./dateformat');</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">exports.add = function (input, addend) {</td></tr><tr class="hit"><td class="line">6</td><td class="hits">15</td><td class="source">  if (_.isArray(input) &amp;&amp; _.isArray(addend)) {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">2</td><td class="source">    return input.concat(addend);</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">10</td><td class="hits">13</td><td class="source">  if (typeof input === 'object' &amp;&amp; typeof addend === 'object') {</td></tr><tr class="hit"><td class="line">11</td><td class="hits">2</td><td class="source">    return _.extend(input, addend);</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">11</td><td class="source">  if (_.isNumber(input) &amp;&amp; _.isNumber(addend)) {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">6</td><td class="source">    return input + addend;</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">18</td><td class="hits">5</td><td class="source">  return input + addend;</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">exports.addslashes = function (input) {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">6</td><td class="source">  if (typeof input === 'object') {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">    _.each(input, function (value, key) {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">4</td><td class="source">      input[key] = exports.addslashes(value);</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    });</td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">    return input;</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">28</td><td class="hits">5</td><td class="source">  return input.replace(/\\/g, '\\\\').replace(/\'/g, &quot;\\'&quot;).replace(/\&quot;/g, '\\&quot;');</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">exports.capitalize = function (input) {</td></tr><tr class="hit"><td class="line">32</td><td class="hits">7</td><td class="source">  if (typeof input === 'object') {</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">    _.each(input, function (value, key) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">2</td><td class="source">      input[key] = exports.capitalize(value);</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">    });</td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">    return input;</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">38</td><td class="hits">6</td><td class="source">  return input.toString().charAt(0).toUpperCase() + input.toString().substr(1).toLowerCase();</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">exports.date = function (input, format, offset, abbr) {</td></tr><tr class="hit"><td class="line">42</td><td class="hits">56</td><td class="source">  var l = format.length,</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">    date = new dateformat.DateZ(input),</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">    cur,</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">    i = 0,</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    out = '';</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">48</td><td class="hits">56</td><td class="source">  if (offset) {</td></tr><tr class="hit"><td class="line">49</td><td class="hits">55</td><td class="source">    date.setTimezoneOffset(offset, abbr);</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">52</td><td class="hits">56</td><td class="source">  for (i; i &lt; l; i += 1) {</td></tr><tr class="hit"><td class="line">53</td><td class="hits">60</td><td class="source">    cur = format.charAt(i);</td></tr><tr class="hit"><td class="line">54</td><td class="hits">60</td><td class="source">    if (dateformat.hasOwnProperty(cur)) {</td></tr><tr class="hit"><td class="line">55</td><td class="hits">58</td><td class="source">      out += dateformat[cur](date, offset, abbr);</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">57</td><td class="hits">2</td><td class="source">      out += cur;</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">60</td><td class="hits">56</td><td class="source">  return out;</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">63</td><td class="hits">1</td><td class="source">exports['default'] = function (input, def) {</td></tr><tr class="hit"><td class="line">64</td><td class="hits">6</td><td class="source">  return (typeof input !== 'undefined' &amp;&amp; (input || typeof input === 'number')) ? input : def;</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">67</td><td class="hits">1</td><td class="source">exports.escape = exports.e = function (input, type) {</td></tr><tr class="hit"><td class="line">68</td><td class="hits">257</td><td class="source">  type = type || 'html';</td></tr><tr class="hit"><td class="line">69</td><td class="hits">257</td><td class="source">  if (typeof input === 'string') {</td></tr><tr class="hit"><td class="line">70</td><td class="hits">187</td><td class="source">    if (type === 'js') {</td></tr><tr class="hit"><td class="line">71</td><td class="hits">15</td><td class="source">      var i = 0,</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">        code,</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">        out = '';</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">75</td><td class="hits">15</td><td class="source">      input = input.replace(/\\/g, '\\u005C');</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">77</td><td class="hits">15</td><td class="source">      for (i; i &lt; input.length; i += 1) {</td></tr><tr class="hit"><td class="line">78</td><td class="hits">420</td><td class="source">        code = input.charCodeAt(i);</td></tr><tr class="hit"><td class="line">79</td><td class="hits">420</td><td class="source">        if (code &lt; 32) {</td></tr><tr class="hit"><td class="line">80</td><td class="hits">18</td><td class="source">          code = code.toString(16).toUpperCase();</td></tr><tr class="hit"><td class="line">81</td><td class="hits">18</td><td class="source">          code = (code.length &lt; 2) ? '0' + code : code;</td></tr><tr class="hit"><td class="line">82</td><td class="hits">18</td><td class="source">          out += '\\u00' + code;</td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">        } else {</td></tr><tr class="hit"><td class="line">84</td><td class="hits">402</td><td class="source">          out += input[i];</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">88</td><td class="hits">15</td><td class="source">      return out.replace(/&amp;/g, '\\u0026')</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">        .replace(/&lt;/g, '\\u003C')</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">        .replace(/&gt;/g, '\\u003E')</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">        .replace(/\'/g, '\\u0027')</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">        .replace(/&quot;/g, '\\u0022')</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">        .replace(/\=/g, '\\u003D')</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">        .replace(/-/g, '\\u002D')</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">        .replace(/;/g, '\\u003B');</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">97</td><td class="hits">172</td><td class="source">    return input.replace(/&amp;(?!amp;|lt;|gt;|quot;|#39;)/g, '&amp;')</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">      .replace(/&lt;/g, '&lt;')</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">      .replace(/&gt;/g, '&gt;')</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">      .replace(/&quot;/g, '&quot;')</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">      .replace(/'/g, '&#39;');</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">103</td><td class="hits">70</td><td class="source">  return input;</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">106</td><td class="hits">1</td><td class="source">exports.first = function (input) {</td></tr><tr class="hit"><td class="line">107</td><td class="hits">6</td><td class="source">  if (typeof input === 'object' &amp;&amp; !_.isArray(input)) {</td></tr><tr class="hit"><td class="line">108</td><td class="hits">1</td><td class="source">    return '';</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">111</td><td class="hits">5</td><td class="source">  if (typeof input === 'string') {</td></tr><tr class="hit"><td class="line">112</td><td class="hits">1</td><td class="source">    return input.substr(0, 1);</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">115</td><td class="hits">4</td><td class="source">  return _.first(input);</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">118</td><td class="hits">1</td><td class="source">exports.join = function (input, separator) {</td></tr><tr class="hit"><td class="line">119</td><td class="hits">11</td><td class="source">  if (_.isArray(input)) {</td></tr><tr class="hit"><td class="line">120</td><td class="hits">4</td><td class="source">    return input.join(separator);</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">123</td><td class="hits">7</td><td class="source">  if (typeof input === 'object') {</td></tr><tr class="hit"><td class="line">124</td><td class="hits">6</td><td class="source">    var out = [];</td></tr><tr class="hit"><td class="line">125</td><td class="hits">6</td><td class="source">    _.each(input, function (value, key) {</td></tr><tr class="hit"><td class="line">126</td><td class="hits">12</td><td class="source">      out.push(value);</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">    });</td></tr><tr class="hit"><td class="line">128</td><td class="hits">6</td><td class="source">    return out.join(separator);</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">130</td><td class="hits">1</td><td class="source">  return input;</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">133</td><td class="hits">1</td><td class="source">exports.json_encode = function (input, indent) {</td></tr><tr class="hit"><td class="line">134</td><td class="hits">2</td><td class="source">  return JSON.stringify(input, null, indent || 0);</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">137</td><td class="hits">1</td><td class="source">exports.last = function (input) {</td></tr><tr class="hit"><td class="line">138</td><td class="hits">3</td><td class="source">  if (typeof input === 'object' &amp;&amp; !_.isArray(input)) {</td></tr><tr class="hit"><td class="line">139</td><td class="hits">1</td><td class="source">    return '';</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">142</td><td class="hits">2</td><td class="source">  if (typeof input === 'string') {</td></tr><tr class="hit"><td class="line">143</td><td class="hits">1</td><td class="source">    return input.charAt(input.length - 1);</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">146</td><td class="hits">1</td><td class="source">  return _.last(input);</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">149</td><td class="hits">1</td><td class="source">exports.length = function (input) {</td></tr><tr class="hit"><td class="line">150</td><td class="hits">15</td><td class="source">  if (typeof input === 'object') {</td></tr><tr class="hit"><td class="line">151</td><td class="hits">14</td><td class="source">    return _.keys(input).length;</td></tr><tr><td class="line">152</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">153</td><td class="hits">1</td><td class="source">  return input.length;</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">156</td><td class="hits">1</td><td class="source">exports.lower = function (input) {</td></tr><tr class="hit"><td class="line">157</td><td class="hits">11</td><td class="source">  if (typeof input === 'object') {</td></tr><tr class="hit"><td class="line">158</td><td class="hits">2</td><td class="source">    _.each(input, function (value, key) {</td></tr><tr class="hit"><td class="line">159</td><td class="hits">3</td><td class="source">      input[key] = exports.lower(value);</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source">    });</td></tr><tr class="hit"><td class="line">161</td><td class="hits">2</td><td class="source">    return input;</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">163</td><td class="hits">9</td><td class="source">  return input.toString().toLowerCase();</td></tr><tr><td class="line">164</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">166</td><td class="hits">1</td><td class="source">exports.replace = function (input, search, replacement, flags) {</td></tr><tr class="hit"><td class="line">167</td><td class="hits">5</td><td class="source">  var r = new RegExp(search, flags);</td></tr><tr class="hit"><td class="line">168</td><td class="hits">5</td><td class="source">  return input.replace(r, replacement);</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">171</td><td class="hits">1</td><td class="source">exports.reverse = function (input) {</td></tr><tr class="hit"><td class="line">172</td><td class="hits">4</td><td class="source">  if (_.isArray(input)) {</td></tr><tr class="hit"><td class="line">173</td><td class="hits">2</td><td class="source">    return input.reverse();</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">175</td><td class="hits">2</td><td class="source">  return input;</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">178</td><td class="hits">1</td><td class="source">exports.striptags = function (input) {</td></tr><tr class="hit"><td class="line">179</td><td class="hits">1</td><td class="source">  if (typeof input === 'object') {</td></tr><tr class="miss"><td class="line">180</td><td class="hits">0</td><td class="source">    _.each(input, function (value, key) {</td></tr><tr class="miss"><td class="line">181</td><td class="hits">0</td><td class="source">      input[key] = exports.striptags(value);</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">    });</td></tr><tr class="miss"><td class="line">183</td><td class="hits">0</td><td class="source">    return input;</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">185</td><td class="hits">1</td><td class="source">  return input.toString().replace(/(&lt;([^&gt;]+)&gt;)/ig, '');</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">188</td><td class="hits">1</td><td class="source">exports.title = function (input) {</td></tr><tr class="hit"><td class="line">189</td><td class="hits">1</td><td class="source">  if (typeof input === 'object') {</td></tr><tr class="miss"><td class="line">190</td><td class="hits">0</td><td class="source">    _.each(input, function (value, key) {</td></tr><tr class="miss"><td class="line">191</td><td class="hits">0</td><td class="source">      input[key] = exports.title(value);</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">    });</td></tr><tr class="miss"><td class="line">193</td><td class="hits">0</td><td class="source">    return input;</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">195</td><td class="hits">1</td><td class="source">  return input.toString().replace(/\w\S*/g, function (str) {</td></tr><tr class="hit"><td class="line">196</td><td class="hits">4</td><td class="source">    return str.charAt(0).toUpperCase() + str.substr(1).toLowerCase();</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">200</td><td class="hits">1</td><td class="source">exports.uniq = function (input) {</td></tr><tr class="hit"><td class="line">201</td><td class="hits">1</td><td class="source">  return _.uniq(input);</td></tr><tr><td class="line">202</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">204</td><td class="hits">1</td><td class="source">exports.upper = function (input) {</td></tr><tr class="hit"><td class="line">205</td><td class="hits">10</td><td class="source">  if (typeof input === 'object') {</td></tr><tr class="hit"><td class="line">206</td><td class="hits">2</td><td class="source">    _.each(input, function (value, key) {</td></tr><tr class="hit"><td class="line">207</td><td class="hits">3</td><td class="source">      input[key] = exports.upper(value);</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source">    });</td></tr><tr class="hit"><td class="line">209</td><td class="hits">2</td><td class="source">    return input;</td></tr><tr><td class="line">210</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">211</td><td class="hits">8</td><td class="source">  return input.toString().toUpperCase();</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">214</td><td class="hits">1</td><td class="source">exports.url_encode = function (input) {</td></tr><tr class="hit"><td class="line">215</td><td class="hits">1</td><td class="source">  return encodeURIComponent(input);</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">218</td><td class="hits">1</td><td class="source">exports.url_decode = function (input) {</td></tr><tr class="hit"><td class="line">219</td><td class="hits">1</td><td class="source">  return decodeURIComponent(input);</td></tr><tr><td class="line">220</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/helpers.js">/lib/helpers.js</h2><div id="stats" class="high"><div class="percentage">96%</div><div class="sloc">242</div><div class="hits">234</div><div class="misses">8</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var parser = require('./parser'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  _ = require('underscore'),</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">  filters = require('./filters');</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">// Javascript keywords can't be a name: 'for.is_invalid' as well as 'for' but not 'for_' or '_for'</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var KEYWORDS = /^(Array|ArrayBuffer|Boolean|Date|Error|eval|EvalError|Function|Infinity|Iterator|JSON|Math|Namespace|NaN|Number|Object|QName|RangeError|ReferenceError|RegExp|StopIteration|String|SyntaxError|TypeError|undefined|uneval|URIError|XML|XMLList|break|case|catch|continue|debugger|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|this|throw|try|typeof|var|void|while|with)(?=(\.|$))/;</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">// Returns TRUE if the passed string is a valid javascript string literal</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">exports.isStringLiteral = function (string) {</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1532</td><td class="source">  if (typeof string !== 'string') {</td></tr><tr class="miss"><td class="line">11</td><td class="hits">0</td><td class="source">    return false;</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1532</td><td class="source">  var first = string.substring(0, 1),</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">    last = string.charAt(string.length - 1, 1),</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">    teststr;</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">18</td><td class="hits">1532</td><td class="source">  if ((first === last) &amp;&amp; (first === &quot;'&quot; || first === '&quot;')) {</td></tr><tr class="hit"><td class="line">19</td><td class="hits">138</td><td class="source">    teststr = string.substr(1, string.length - 2).split('').reverse().join('');</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">138</td><td class="source">    if ((first === &quot;'&quot; &amp;&amp; (/'(?!\\)/).test(teststr)) || (last === '&quot;' &amp;&amp; (/&quot;(?!\\)/).test(teststr))) {</td></tr><tr class="miss"><td class="line">22</td><td class="hits">0</td><td class="source">      throw new Error('Invalid string literal. Unescaped quote (' + string[0] + ') found.');</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">25</td><td class="hits">138</td><td class="source">    return true;</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">28</td><td class="hits">1394</td><td class="source">  return false;</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">// Returns TRUE if the passed string is a valid javascript number or string literal</td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">exports.isLiteral = function (string) {</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1488</td><td class="source">  var literal = false;</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  // Check if it's a number literal</td></tr><tr class="hit"><td class="line">36</td><td class="hits">1488</td><td class="source">  if ((/^\d+([.]\d+)?$/).test(string)) {</td></tr><tr class="hit"><td class="line">37</td><td class="hits">73</td><td class="source">    literal = true;</td></tr><tr class="hit"><td class="line">38</td><td class="hits">1415</td><td class="source">  } else if (exports.isStringLiteral(string)) {</td></tr><tr class="hit"><td class="line">39</td><td class="hits">85</td><td class="source">    literal = true;</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">42</td><td class="hits">1488</td><td class="source">  return literal;</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">// Variable names starting with __ are reserved.</td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">exports.isValidName = function (string) {</td></tr><tr class="hit"><td class="line">47</td><td class="hits">740</td><td class="source">  return ((typeof string === 'string')</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">    &amp;&amp; string.substr(0, 2) !== '__'</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">    &amp;&amp; (/^([$A-Za-z_]+[$A-Za-z_0-9]*)(\.?([$A-Za-z_]+[$A-Za-z_0-9]*))*$/).test(string)</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">    &amp;&amp; !KEYWORDS.test(string));</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">// Variable names starting with __ are reserved.</td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">exports.isValidShortName = function (string) {</td></tr><tr class="hit"><td class="line">55</td><td class="hits">31</td><td class="source">  return string.substr(0, 2) !== '__' &amp;&amp; (/^[$A-Za-z_]+[$A-Za-z_0-9]*$/).test(string) &amp;&amp; !KEYWORDS.test(string);</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">// Checks if a name is a vlaid block name</td></tr><tr class="hit"><td class="line">59</td><td class="hits">1</td><td class="source">exports.isValidBlockName = function (string) {</td></tr><tr class="hit"><td class="line">60</td><td class="hits">48</td><td class="source">  return (/^[A-Za-z]+[A-Za-z_0-9]*$/).test(string);</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">63</td><td class="hits">1</td><td class="source">function stripWhitespace(input) {</td></tr><tr class="hit"><td class="line">64</td><td class="hits">1062</td><td class="source">  return input.replace(/^\s+|\s+$/g, '');</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">}</td></tr><tr class="hit"><td class="line">66</td><td class="hits">1</td><td class="source">exports.stripWhitespace = stripWhitespace;</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">// the varname is split on (/(\.|\[|\])/) but it may contain keys with dots,</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">// e.g. obj['hello.there']</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">// this function searches for these and preserves the literal parts</td></tr><tr class="hit"><td class="line">71</td><td class="hits">1</td><td class="source">function filterVariablePath(props) {</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">73</td><td class="hits">1126</td><td class="source">	var filtered = [],</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">		literal = '',</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">		i = 0;</td></tr><tr class="hit"><td class="line">76</td><td class="hits">1126</td><td class="source">	for (i; i &lt; props.length; i += 1) {</td></tr><tr class="hit"><td class="line">77</td><td class="hits">2470</td><td class="source">		if (props[i] &amp;&amp; props[i].charAt(0) !== props[i].charAt(props[i].length - 1) &amp;&amp;</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">				(props[i].indexOf('&quot;') === 0 || props[i].indexOf(&quot;'&quot;) === 0)) {</td></tr><tr class="hit"><td class="line">79</td><td class="hits">4</td><td class="source">			literal = props[i];</td></tr><tr class="hit"><td class="line">80</td><td class="hits">4</td><td class="source">			continue;</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">		}</td></tr><tr class="hit"><td class="line">82</td><td class="hits">2466</td><td class="source">		if (props[i] === '.' &amp;&amp; literal) {</td></tr><tr class="hit"><td class="line">83</td><td class="hits">4</td><td class="source">			literal += '.';</td></tr><tr class="hit"><td class="line">84</td><td class="hits">4</td><td class="source">			continue;</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">		}</td></tr><tr class="hit"><td class="line">86</td><td class="hits">2462</td><td class="source">		if (props[i].indexOf('&quot;') === props[i].length - 1 || props[i].indexOf(&quot;'&quot;) === props[i].length - 1) {</td></tr><tr class="hit"><td class="line">87</td><td class="hits">4</td><td class="source">			literal += props[i];</td></tr><tr class="hit"><td class="line">88</td><td class="hits">4</td><td class="source">			filtered.push(literal);</td></tr><tr class="hit"><td class="line">89</td><td class="hits">4</td><td class="source">			literal = '';</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">		} else {</td></tr><tr class="hit"><td class="line">91</td><td class="hits">2458</td><td class="source">			filtered.push(props[i]);</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">		}</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">	}</td></tr><tr class="hit"><td class="line">94</td><td class="hits">1126</td><td class="source">	return _.compact(filtered);</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">* Returns a valid javascript code that will</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">* check if a variable (or property chain) exists</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">* in the evaled context. For example:</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">*  check('foo.bar.baz')</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">* will return the following string:</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">*  typeof foo !== 'undefined' &amp;&amp; typeof foo.bar !== 'undefined' &amp;&amp; typeof foo.bar.baz !== 'undefined'</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">*/</td></tr><tr class="hit"><td class="line">105</td><td class="hits">1</td><td class="source">function check(variable, context) {</td></tr><tr class="hit"><td class="line">106</td><td class="hits">615</td><td class="source">  if (_.isArray(variable)) {</td></tr><tr class="miss"><td class="line">107</td><td class="hits">0</td><td class="source">    return '(true)';</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">110</td><td class="hits">615</td><td class="source">  variable = variable.replace(/^this/, '_this.__currentContext');</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">112</td><td class="hits">615</td><td class="source">  if (exports.isLiteral(variable)) {</td></tr><tr class="hit"><td class="line">113</td><td class="hits">64</td><td class="source">    return '(true)';</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">116</td><td class="hits">551</td><td class="source">  var props = variable.split(/(\.|\[|\])/),</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">    chain = '',</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">    output = [],</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">    inArr = false,</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">    prevDot = false;</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">122</td><td class="hits">551</td><td class="source">  if (typeof context === 'string' &amp;&amp; context.length) {</td></tr><tr class="hit"><td class="line">123</td><td class="hits">276</td><td class="source">    props.unshift(context);</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">126</td><td class="hits">551</td><td class="source">  props = _.reject(props, function (val) {</td></tr><tr class="hit"><td class="line">127</td><td class="hits">1083</td><td class="source">    return val === '';</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">130</td><td class="hits">551</td><td class="source">  props = filterVariablePath(props);</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">132</td><td class="hits">551</td><td class="source">  _.each(props, function (prop) {</td></tr><tr class="hit"><td class="line">133</td><td class="hits">1057</td><td class="source">    if (prop === '.') {</td></tr><tr class="hit"><td class="line">134</td><td class="hits">82</td><td class="source">      prevDot = true;</td></tr><tr class="hit"><td class="line">135</td><td class="hits">82</td><td class="source">      return;</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">138</td><td class="hits">975</td><td class="source">    if (prop === '[') {</td></tr><tr class="hit"><td class="line">139</td><td class="hits">22</td><td class="source">      inArr = true;</td></tr><tr class="hit"><td class="line">140</td><td class="hits">22</td><td class="source">      return;</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">143</td><td class="hits">953</td><td class="source">    if (prop === ']') {</td></tr><tr class="hit"><td class="line">144</td><td class="hits">22</td><td class="source">      inArr = false;</td></tr><tr class="hit"><td class="line">145</td><td class="hits">22</td><td class="source">      return;</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">148</td><td class="hits">931</td><td class="source">    if (!chain) {</td></tr><tr class="hit"><td class="line">149</td><td class="hits">551</td><td class="source">      chain = prop;</td></tr><tr class="hit"><td class="line">150</td><td class="hits">380</td><td class="source">    } else if (inArr) {</td></tr><tr class="hit"><td class="line">151</td><td class="hits">28</td><td class="source">      if (!exports.isStringLiteral(prop)) {</td></tr><tr class="hit"><td class="line">152</td><td class="hits">24</td><td class="source">        if (prevDot) {</td></tr><tr class="hit"><td class="line">153</td><td class="hits">6</td><td class="source">          output[output.length - 1] = _.last(output).replace(/\] !== &quot;undefined&quot;$/, '_' + prop + '] !== &quot;undefined&quot;');</td></tr><tr class="hit"><td class="line">154</td><td class="hits">6</td><td class="source">          chain = chain.replace(/\]$/, '_' + prop + ']');</td></tr><tr class="hit"><td class="line">155</td><td class="hits">6</td><td class="source">          return;</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">157</td><td class="hits">18</td><td class="source">        chain += '[___' + prop + ']';</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">159</td><td class="hits">4</td><td class="source">        chain += '[' + prop + ']';</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">162</td><td class="hits">352</td><td class="source">      chain += '.' + prop;</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">164</td><td class="hits">925</td><td class="source">    prevDot = false;</td></tr><tr class="hit"><td class="line">165</td><td class="hits">925</td><td class="source">    output.push('typeof ' + chain + ' !== &quot;undefined&quot;');</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">168</td><td class="hits">551</td><td class="source">  return '(' + output.join(' &amp;&amp; ') + ')';</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">}</td></tr><tr class="hit"><td class="line">170</td><td class="hits">1</td><td class="source">exports.check = check;</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">173</td><td class="hits"></td><td class="source">* Returns an escaped string (safe for evaling). If context is passed</td></tr><tr><td class="line">174</td><td class="hits"></td><td class="source">* then returns a concatenation of context and the escaped variable name.</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">*/</td></tr><tr class="hit"><td class="line">176</td><td class="hits">1</td><td class="source">exports.escapeVarName = function (variable, context, args) {</td></tr><tr class="hit"><td class="line">177</td><td class="hits">746</td><td class="source">  if (variable === '') {</td></tr><tr class="hit"><td class="line">178</td><td class="hits">107</td><td class="source">    return '';</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">180</td><td class="hits">639</td><td class="source">  if (_.isArray(variable)) {</td></tr><tr class="miss"><td class="line">181</td><td class="hits">0</td><td class="source">    _.each(variable, function (val, key) {</td></tr><tr class="miss"><td class="line">182</td><td class="hits">0</td><td class="source">      variable[key] = exports.escapeVarName(val, context);</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">    });</td></tr><tr class="miss"><td class="line">184</td><td class="hits">0</td><td class="source">    return variable;</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">187</td><td class="hits">639</td><td class="source">  variable = variable.replace(/^this/, '_this.__currentContext');</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">189</td><td class="hits">639</td><td class="source">  if (exports.isLiteral(variable)) {</td></tr><tr class="hit"><td class="line">190</td><td class="hits">64</td><td class="source">    return variable;</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">192</td><td class="hits">575</td><td class="source">  if (typeof context === 'string' &amp;&amp; context.length) {</td></tr><tr class="hit"><td class="line">193</td><td class="hits">300</td><td class="source">    variable = context + '.' + variable;</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">196</td><td class="hits">575</td><td class="source">  var chain = '',</td></tr><tr><td class="line">197</td><td class="hits"></td><td class="source">    props = variable.split(/(\.|\[|\])/),</td></tr><tr><td class="line">198</td><td class="hits"></td><td class="source">    inArr = false,</td></tr><tr><td class="line">199</td><td class="hits"></td><td class="source">    prevDot = false;</td></tr><tr><td class="line">200</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">201</td><td class="hits">575</td><td class="source">  props = _.reject(props, function (val) {</td></tr><tr class="hit"><td class="line">202</td><td class="hits">1431</td><td class="source">    return val === '';</td></tr><tr><td class="line">203</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">205</td><td class="hits">575</td><td class="source">  props = filterVariablePath(props);</td></tr><tr><td class="line">206</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">207</td><td class="hits">575</td><td class="source">  _.each(props, function (prop) {</td></tr><tr class="hit"><td class="line">208</td><td class="hits">1405</td><td class="source">    if (prop === '.') {</td></tr><tr class="hit"><td class="line">209</td><td class="hits">382</td><td class="source">      prevDot = true;</td></tr><tr class="hit"><td class="line">210</td><td class="hits">382</td><td class="source">      return;</td></tr><tr><td class="line">211</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">213</td><td class="hits">1023</td><td class="source">    if (prop === '[') {</td></tr><tr class="hit"><td class="line">214</td><td class="hits">22</td><td class="source">      inArr = true;</td></tr><tr class="hit"><td class="line">215</td><td class="hits">22</td><td class="source">      return;</td></tr><tr><td class="line">216</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">217</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">218</td><td class="hits">1001</td><td class="source">    if (prop === ']') {</td></tr><tr class="hit"><td class="line">219</td><td class="hits">22</td><td class="source">      inArr = false;</td></tr><tr class="hit"><td class="line">220</td><td class="hits">22</td><td class="source">      return;</td></tr><tr><td class="line">221</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">222</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">223</td><td class="hits">979</td><td class="source">    if (!chain) {</td></tr><tr class="hit"><td class="line">224</td><td class="hits">575</td><td class="source">      chain = prop;</td></tr><tr class="hit"><td class="line">225</td><td class="hits">404</td><td class="source">    } else if (inArr) {</td></tr><tr class="hit"><td class="line">226</td><td class="hits">28</td><td class="source">      if (!exports.isStringLiteral(prop)) {</td></tr><tr class="hit"><td class="line">227</td><td class="hits">24</td><td class="source">        if (prevDot) {</td></tr><tr class="hit"><td class="line">228</td><td class="hits">6</td><td class="source">          chain = chain.replace(/\]$/, '_' + prop + ']');</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source">        } else {</td></tr><tr class="hit"><td class="line">230</td><td class="hits">18</td><td class="source">          chain += '[___' + prop + ']';</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">232</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">233</td><td class="hits">4</td><td class="source">        chain += '[' + prop + ']';</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">236</td><td class="hits">376</td><td class="source">      chain += '.' + prop;</td></tr><tr><td class="line">237</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">238</td><td class="hits">979</td><td class="source">    prevDot = false;</td></tr><tr><td class="line">239</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">241</td><td class="hits">575</td><td class="source">  return '(typeof ' + chain + ' === \'function\') ? ' + chain + '(' + args + ') : ' + chain;</td></tr><tr><td class="line">242</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">243</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">244</td><td class="hits">1</td><td class="source">exports.wrapArgs = function (args) {</td></tr><tr class="hit"><td class="line">245</td><td class="hits">1019</td><td class="source">  if (!args) {</td></tr><tr class="hit"><td class="line">246</td><td class="hits">657</td><td class="source">    return { declarations: '', args: ''};</td></tr><tr><td class="line">247</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">248</td><td class="hits">362</td><td class="source">  var declarations = '';</td></tr><tr class="hit"><td class="line">249</td><td class="hits">362</td><td class="source">  args = _.map(args.split(','), function (value) {</td></tr><tr class="hit"><td class="line">250</td><td class="hits">786</td><td class="source">    var varname,</td></tr><tr><td class="line">251</td><td class="hits"></td><td class="source">      stripped = value.replace(/^\s+|\s+$/g, '');</td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">253</td><td class="hits">786</td><td class="source">    try {</td></tr><tr class="hit"><td class="line">254</td><td class="hits">786</td><td class="source">      varname = '__' + parser.parseVariable(stripped).name.replace(/\W/g, '_');</td></tr><tr><td class="line">255</td><td class="hits"></td><td class="source">    } catch (e) {</td></tr><tr class="hit"><td class="line">256</td><td class="hits">235</td><td class="source">      return value;</td></tr><tr><td class="line">257</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">259</td><td class="hits">551</td><td class="source">    if (exports.isValidName(stripped)) {</td></tr><tr class="hit"><td class="line">260</td><td class="hits">14</td><td class="source">      declarations += exports.setVar(varname, parser.parseVariable(stripped));</td></tr><tr class="hit"><td class="line">261</td><td class="hits">14</td><td class="source">      return varname;</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">263</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">264</td><td class="hits">537</td><td class="source">    return value;</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">267</td><td class="hits">362</td><td class="source">  return { declarations: declarations, args: (args &amp;&amp; args.length) ? args.join(',') : '&quot;&quot;' };</td></tr><tr><td class="line">268</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">269</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">270</td><td class="hits">1</td><td class="source">exports.wrapMethod = function (variable, filter, context) {</td></tr><tr class="hit"><td class="line">271</td><td class="hits">711</td><td class="source">  var output = '(function () {\n',</td></tr><tr><td class="line">272</td><td class="hits"></td><td class="source">    args,</td></tr><tr><td class="line">273</td><td class="hits"></td><td class="source">    wrappedArgs;</td></tr><tr><td class="line">274</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">275</td><td class="hits">711</td><td class="source">  variable = variable || '&quot;&quot;';</td></tr><tr><td class="line">276</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">277</td><td class="hits">711</td><td class="source">  if (!filter) {</td></tr><tr class="miss"><td class="line">278</td><td class="hits">0</td><td class="source">    return variable;</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">281</td><td class="hits">711</td><td class="source">  wrappedArgs = exports.wrapArgs(filter.args, output);</td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">283</td><td class="hits">711</td><td class="source">  output += wrappedArgs.declarations;</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">285</td><td class="hits">711</td><td class="source">  output += 'return ';</td></tr><tr class="hit"><td class="line">286</td><td class="hits">711</td><td class="source">  output += (context) ? context + '[&quot;' : '';</td></tr><tr class="hit"><td class="line">287</td><td class="hits">711</td><td class="source">  output += filter.name;</td></tr><tr class="hit"><td class="line">288</td><td class="hits">711</td><td class="source">  output += (context) ? '&quot;]' : '';</td></tr><tr class="hit"><td class="line">289</td><td class="hits">711</td><td class="source">  output += '(';</td></tr><tr class="hit"><td class="line">290</td><td class="hits">711</td><td class="source">  output += wrappedArgs.args;</td></tr><tr class="hit"><td class="line">291</td><td class="hits">711</td><td class="source">  output += ');\n';</td></tr><tr><td class="line">292</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">293</td><td class="hits">711</td><td class="source">  return output + '})()';</td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">295</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">296</td><td class="hits">1</td><td class="source">exports.wrapFilter = function (variable, filter) {</td></tr><tr class="hit"><td class="line">297</td><td class="hits">337</td><td class="source">  var output = '',</td></tr><tr><td class="line">298</td><td class="hits"></td><td class="source">    args = '';</td></tr><tr><td class="line">299</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">300</td><td class="hits">337</td><td class="source">  variable = variable || '&quot;&quot;';</td></tr><tr><td class="line">301</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">302</td><td class="hits">337</td><td class="source">  if (!filter) {</td></tr><tr class="miss"><td class="line">303</td><td class="hits">0</td><td class="source">    return variable;</td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">305</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">306</td><td class="hits">337</td><td class="source">  if (filters.hasOwnProperty(filter.name)) {</td></tr><tr class="hit"><td class="line">307</td><td class="hits">335</td><td class="source">    args = (filter.args) ? variable + ', ' + filter.args : variable;</td></tr><tr class="hit"><td class="line">308</td><td class="hits">335</td><td class="source">    output += exports.wrapMethod(variable, { name: filter.name, args: args }, '_filters');</td></tr><tr><td class="line">309</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">310</td><td class="hits">2</td><td class="source">    throw new Error('Filter &quot;' + filter.name + '&quot; not found');</td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">312</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">313</td><td class="hits">335</td><td class="source">  return output;</td></tr><tr><td class="line">314</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">315</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">316</td><td class="hits">1</td><td class="source">exports.wrapFilters = function (variable, filters, context, escape, args) {</td></tr><tr class="hit"><td class="line">317</td><td class="hits">722</td><td class="source">  var output = exports.escapeVarName(variable, context, args);</td></tr><tr><td class="line">318</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">319</td><td class="hits">722</td><td class="source">  if (filters &amp;&amp; filters.length &gt; 0) {</td></tr><tr class="hit"><td class="line">320</td><td class="hits">322</td><td class="source">    _.each(filters, function (filter) {</td></tr><tr class="hit"><td class="line">321</td><td class="hits">364</td><td class="source">      switch (filter.name) {</td></tr><tr><td class="line">322</td><td class="hits"></td><td class="source">      case 'raw':</td></tr><tr class="hit"><td class="line">323</td><td class="hits">9</td><td class="source">        escape = false;</td></tr><tr class="hit"><td class="line">324</td><td class="hits">9</td><td class="source">        return;</td></tr><tr><td class="line">325</td><td class="hits"></td><td class="source">      case 'e':</td></tr><tr><td class="line">326</td><td class="hits"></td><td class="source">      case 'escape':</td></tr><tr class="hit"><td class="line">327</td><td class="hits">24</td><td class="source">        escape = filter.args || escape;</td></tr><tr class="hit"><td class="line">328</td><td class="hits">24</td><td class="source">        return;</td></tr><tr><td class="line">329</td><td class="hits"></td><td class="source">      default:</td></tr><tr class="hit"><td class="line">330</td><td class="hits">331</td><td class="source">        output = exports.wrapFilter(output, filter, '_filters');</td></tr><tr class="hit"><td class="line">331</td><td class="hits">330</td><td class="source">        break;</td></tr><tr><td class="line">332</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">333</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">334</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">335</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">336</td><td class="hits">721</td><td class="source">  output = output || '&quot;&quot;';</td></tr><tr class="hit"><td class="line">337</td><td class="hits">721</td><td class="source">  if (escape) {</td></tr><tr class="hit"><td class="line">338</td><td class="hits">465</td><td class="source">    output = '_filters.escape.call(this, ' + output + ', ' + escape + ')';</td></tr><tr><td class="line">339</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">340</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">341</td><td class="hits">721</td><td class="source">  return output;</td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">343</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">344</td><td class="hits">1</td><td class="source">exports.setVar = function (varName, argument, args) {</td></tr><tr class="hit"><td class="line">345</td><td class="hits">308</td><td class="source">  var out = '',</td></tr><tr><td class="line">346</td><td class="hits"></td><td class="source">    props,</td></tr><tr><td class="line">347</td><td class="hits"></td><td class="source">    output,</td></tr><tr><td class="line">348</td><td class="hits"></td><td class="source">    inArr,</td></tr><tr><td class="line">349</td><td class="hits"></td><td class="source">    wrappedArgs;</td></tr><tr class="hit"><td class="line">350</td><td class="hits">308</td><td class="source">  if ((/\[/).test(argument.name)) {</td></tr><tr class="hit"><td class="line">351</td><td class="hits">6</td><td class="source">    props = argument.name.split(/(\[|\])/);</td></tr><tr class="hit"><td class="line">352</td><td class="hits">6</td><td class="source">    output = [];</td></tr><tr class="hit"><td class="line">353</td><td class="hits">6</td><td class="source">    inArr = false;</td></tr><tr><td class="line">354</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">355</td><td class="hits">6</td><td class="source">    _.each(props, function (prop) {</td></tr><tr class="hit"><td class="line">356</td><td class="hits">50</td><td class="source">      if (prop === '') {</td></tr><tr class="hit"><td class="line">357</td><td class="hits">9</td><td class="source">        return;</td></tr><tr><td class="line">358</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">359</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">360</td><td class="hits">41</td><td class="source">      if (prop === '[') {</td></tr><tr class="hit"><td class="line">361</td><td class="hits">11</td><td class="source">        inArr = true;</td></tr><tr class="hit"><td class="line">362</td><td class="hits">11</td><td class="source">        return;</td></tr><tr><td class="line">363</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">365</td><td class="hits">30</td><td class="source">      if (prop === ']') {</td></tr><tr class="hit"><td class="line">366</td><td class="hits">11</td><td class="source">        inArr = false;</td></tr><tr class="hit"><td class="line">367</td><td class="hits">11</td><td class="source">        return;</td></tr><tr><td class="line">368</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">369</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">370</td><td class="hits">19</td><td class="source">      if (inArr &amp;&amp; !exports.isStringLiteral(prop)) {</td></tr><tr class="hit"><td class="line">371</td><td class="hits">9</td><td class="source">        out += exports.setVar('___' + prop.replace(/\W/g, '_'), { name: prop, filters: [], escape: true });</td></tr><tr><td class="line">372</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">373</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">374</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">375</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">376</td><td class="hits">308</td><td class="source">  wrappedArgs = exports.wrapArgs(args);</td></tr><tr class="hit"><td class="line">377</td><td class="hits">308</td><td class="source">  out += wrappedArgs.declarations;</td></tr><tr class="hit"><td class="line">378</td><td class="hits">308</td><td class="source">  out += 'var ' + varName + ' = &quot;&quot;;\n' +</td></tr><tr><td class="line">379</td><td class="hits"></td><td class="source">    'if (' + check(argument.name, '_context') + ') {\n' +</td></tr><tr><td class="line">380</td><td class="hits"></td><td class="source">    '  ' + varName + ' = ' + exports.wrapFilters(argument.name, argument.filters, '_context', argument.escape, wrappedArgs.args) + ';\n' +</td></tr><tr><td class="line">381</td><td class="hits"></td><td class="source">    '} else if (' + check(argument.name) + ') {\n' +</td></tr><tr><td class="line">382</td><td class="hits"></td><td class="source">    '  ' + varName + ' = ' + exports.wrapFilters(argument.name, argument.filters, null, argument.escape, wrappedArgs.args)  + ';\n' +</td></tr><tr><td class="line">383</td><td class="hits"></td><td class="source">    '}\n';</td></tr><tr><td class="line">384</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">385</td><td class="hits">307</td><td class="source">  if (argument.filters.length) {</td></tr><tr class="hit"><td class="line">386</td><td class="hits">107</td><td class="source">    out += ' else if (true) {\n';</td></tr><tr class="hit"><td class="line">387</td><td class="hits">107</td><td class="source">    out += '  ' + varName + ' = ' + exports.wrapFilters('', argument.filters, null, argument.escape, wrappedArgs.args) + ';\n';</td></tr><tr class="hit"><td class="line">388</td><td class="hits">107</td><td class="source">    out += '}\n';</td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">390</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">391</td><td class="hits">307</td><td class="source">  return out;</td></tr><tr><td class="line">392</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">393</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">394</td><td class="hits">1</td><td class="source">exports.parseIfArgs = function (args, parser) {</td></tr><tr class="hit"><td class="line">395</td><td class="hits">49</td><td class="source">  var operators = ['==', '&lt;', '&gt;', '!=', '&lt;=', '&gt;=', '===', '!==', '&amp;&amp;', '||', 'in', 'and', 'or', 'mod', '%'],</td></tr><tr><td class="line">396</td><td class="hits"></td><td class="source">    errorString = 'Bad if-syntax in `{% if ' + args.join(' ') + ' %}...',</td></tr><tr><td class="line">397</td><td class="hits"></td><td class="source">    startParen = /^\(+/,</td></tr><tr><td class="line">398</td><td class="hits"></td><td class="source">    endParen = /\)+$/,</td></tr><tr><td class="line">399</td><td class="hits"></td><td class="source">    tokens = [],</td></tr><tr><td class="line">400</td><td class="hits"></td><td class="source">    prevType,</td></tr><tr><td class="line">401</td><td class="hits"></td><td class="source">    last,</td></tr><tr><td class="line">402</td><td class="hits"></td><td class="source">    closing = 0;</td></tr><tr><td class="line">403</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">404</td><td class="hits">49</td><td class="source">  _.each(args, function (value, index) {</td></tr><tr class="hit"><td class="line">405</td><td class="hits">104</td><td class="source">    var endsep = 0,</td></tr><tr><td class="line">406</td><td class="hits"></td><td class="source">      startsep = 0,</td></tr><tr><td class="line">407</td><td class="hits"></td><td class="source">      operand;</td></tr><tr><td class="line">408</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">409</td><td class="hits">104</td><td class="source">    if (startParen.test(value)) {</td></tr><tr class="hit"><td class="line">410</td><td class="hits">8</td><td class="source">      startsep = value.match(startParen)[0].length;</td></tr><tr class="hit"><td class="line">411</td><td class="hits">8</td><td class="source">      closing += startsep;</td></tr><tr class="hit"><td class="line">412</td><td class="hits">8</td><td class="source">      value = value.replace(startParen, '');</td></tr><tr><td class="line">413</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">414</td><td class="hits">8</td><td class="source">      while (startsep) {</td></tr><tr class="hit"><td class="line">415</td><td class="hits">9</td><td class="source">        startsep -= 1;</td></tr><tr class="hit"><td class="line">416</td><td class="hits">9</td><td class="source">        tokens.push({ type: 'separator', value: '(' });</td></tr><tr><td class="line">417</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">418</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">419</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">420</td><td class="hits">104</td><td class="source">    if ((/^\![^=]/).test(value) || (value === 'not')) {</td></tr><tr class="hit"><td class="line">421</td><td class="hits">4</td><td class="source">      if (value === 'not') {</td></tr><tr class="hit"><td class="line">422</td><td class="hits">2</td><td class="source">        value = '';</td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">424</td><td class="hits">2</td><td class="source">        value = value.substr(1);</td></tr><tr><td class="line">425</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">426</td><td class="hits">4</td><td class="source">      tokens.push({ type: 'operator', value: '!' });</td></tr><tr><td class="line">427</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">428</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">429</td><td class="hits">104</td><td class="source">    if (endParen.test(value) &amp;&amp; value.indexOf('(') === -1) {</td></tr><tr class="hit"><td class="line">430</td><td class="hits">7</td><td class="source">      if (!closing) {</td></tr><tr class="hit"><td class="line">431</td><td class="hits">1</td><td class="source">        throw new Error(errorString);</td></tr><tr><td class="line">432</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">433</td><td class="hits">6</td><td class="source">      endsep = value.match(endParen)[0].length;</td></tr><tr class="hit"><td class="line">434</td><td class="hits">6</td><td class="source">      value = value.replace(endParen, '');</td></tr><tr class="hit"><td class="line">435</td><td class="hits">6</td><td class="source">      closing -= endsep;</td></tr><tr><td class="line">436</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">437</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">438</td><td class="hits">103</td><td class="source">    if (value === 'in') {</td></tr><tr class="hit"><td class="line">439</td><td class="hits">2</td><td class="source">      last = tokens.pop();</td></tr><tr class="hit"><td class="line">440</td><td class="hits">2</td><td class="source">      prevType = 'inindex';</td></tr><tr class="hit"><td class="line">441</td><td class="hits">101</td><td class="source">    } else if (_.indexOf(operators, value) !== -1) {</td></tr><tr class="hit"><td class="line">442</td><td class="hits">25</td><td class="source">      if (prevType === 'operator') {</td></tr><tr class="hit"><td class="line">443</td><td class="hits">1</td><td class="source">        throw new Error(errorString);</td></tr><tr><td class="line">444</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">445</td><td class="hits">24</td><td class="source">      value = value.replace('and', '&amp;&amp;').replace('or', '||').replace('mod', '%');</td></tr><tr class="hit"><td class="line">446</td><td class="hits">24</td><td class="source">      tokens.push({</td></tr><tr><td class="line">447</td><td class="hits"></td><td class="source">        value: value</td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source">      });</td></tr><tr class="hit"><td class="line">449</td><td class="hits">24</td><td class="source">      prevType = 'operator';</td></tr><tr class="hit"><td class="line">450</td><td class="hits">76</td><td class="source">    } else if (value !== '') {</td></tr><tr class="hit"><td class="line">451</td><td class="hits">68</td><td class="source">      if (prevType === 'value') {</td></tr><tr class="hit"><td class="line">452</td><td class="hits">1</td><td class="source">        throw new Error(errorString);</td></tr><tr><td class="line">453</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">454</td><td class="hits">67</td><td class="source">      operand = parser.parseVariable(value);</td></tr><tr><td class="line">455</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">456</td><td class="hits">67</td><td class="source">      if (prevType === 'inindex') {</td></tr><tr class="hit"><td class="line">457</td><td class="hits">2</td><td class="source">        tokens.push({</td></tr><tr><td class="line">458</td><td class="hits"></td><td class="source">          preout: last.preout + exports.setVar('__op' + index, operand),</td></tr><tr><td class="line">459</td><td class="hits"></td><td class="source">          value: '(((_.isArray(__op' + index + ') || typeof __op' + index + ' === &quot;string&quot;) &amp;&amp; _.indexOf(__op' + index + ', ' + last.value + ') !== -1) || (typeof __op' + index + ' === &quot;object&quot; &amp;&amp; ' + last.value + ' in __op' + index + '))'</td></tr><tr><td class="line">460</td><td class="hits"></td><td class="source">        });</td></tr><tr class="hit"><td class="line">461</td><td class="hits">2</td><td class="source">        last = null;</td></tr><tr><td class="line">462</td><td class="hits"></td><td class="source">      } else {</td></tr><tr class="hit"><td class="line">463</td><td class="hits">65</td><td class="source">        tokens.push({</td></tr><tr><td class="line">464</td><td class="hits"></td><td class="source">          preout: exports.setVar('__op' + index, operand),</td></tr><tr><td class="line">465</td><td class="hits"></td><td class="source">          value: '__op' + index</td></tr><tr><td class="line">466</td><td class="hits"></td><td class="source">        });</td></tr><tr><td class="line">467</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">468</td><td class="hits">67</td><td class="source">      prevType = 'value';</td></tr><tr><td class="line">469</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">470</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">471</td><td class="hits">101</td><td class="source">    while (endsep) {</td></tr><tr class="hit"><td class="line">472</td><td class="hits">8</td><td class="source">      endsep -= 1;</td></tr><tr class="hit"><td class="line">473</td><td class="hits">8</td><td class="source">      tokens.push({ type: 'separator', value: ')' });</td></tr><tr><td class="line">474</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">475</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">476</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">477</td><td class="hits">46</td><td class="source">  if (closing &gt; 0) {</td></tr><tr class="hit"><td class="line">478</td><td class="hits">1</td><td class="source">    throw new Error(errorString);</td></tr><tr><td class="line">479</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">480</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">481</td><td class="hits">45</td><td class="source">  return tokens;</td></tr><tr><td class="line">482</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">483</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/parser.js">/lib/parser.js</h2><div id="stats" class="high"><div class="percentage">95%</div><div class="sloc">237</div><div class="hits">227</div><div class="misses">10</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var helpers = require('./helpers'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  filters = require('./filters'),</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">  _ = require('underscore');</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var variableRegexp  = /^\{\{[^\r]*?\}\}$/,</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">  logicRegexp   = /^\{%[^\r]*?%\}$/,</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">  commentRegexp   = /^\{#[^\r]*?#\}$/,</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">  TEMPLATE = exports.TEMPLATE = 0,</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">  LOGIC_TOKEN = 1,</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">  VAR_TOKEN   = 2;</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">exports.TOKEN_TYPES = {</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  TEMPLATE: TEMPLATE,</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  LOGIC: LOGIC_TOKEN,</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  VAR: VAR_TOKEN</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">function getMethod(input) {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">403</td><td class="source">  return helpers.stripWhitespace(input).match(/^[\w\.]+/)[0];</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">function doubleEscape(input) {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1021</td><td class="source">  return input.replace(/\\/g, '\\\\');</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">function getArgs(input) {</td></tr><tr class="hit"><td class="line">28</td><td class="hits">352</td><td class="source">  return doubleEscape(helpers.stripWhitespace(input).replace(/^[\w\.]+\(|\)$/g, ''));</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">function getContextVar(varName, context) {</td></tr><tr class="miss"><td class="line">32</td><td class="hits">0</td><td class="source">  var a = varName.split(&quot;.&quot;);</td></tr><tr class="miss"><td class="line">33</td><td class="hits">0</td><td class="source">  while (a.length) {</td></tr><tr class="miss"><td class="line">34</td><td class="hits">0</td><td class="source">    context = context[a.splice(0, 1)[0]];</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  }</td></tr><tr class="miss"><td class="line">36</td><td class="hits">0</td><td class="source">  return context;</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">function getTokenArgs(token, parts) {</td></tr><tr class="hit"><td class="line">40</td><td class="hits">238</td><td class="source">  parts = _.map(parts, doubleEscape);</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">42</td><td class="hits">238</td><td class="source">  var i = 0,</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">    l = parts.length,</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">    arg,</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">    ender,</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    out = [];</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">48</td><td class="hits">238</td><td class="source">  function concat(from, ending) {</td></tr><tr class="hit"><td class="line">49</td><td class="hits">11</td><td class="source">    var end = new RegExp('\\' + ending + '$'),</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">      i = from,</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">      out = '';</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">53</td><td class="hits">11</td><td class="source">    while (!(end).test(out) &amp;&amp; i &lt; parts.length) {</td></tr><tr class="hit"><td class="line">54</td><td class="hits">36</td><td class="source">      out += ' ' + parts[i];</td></tr><tr class="hit"><td class="line">55</td><td class="hits">36</td><td class="source">      parts[i] = null;</td></tr><tr class="hit"><td class="line">56</td><td class="hits">36</td><td class="source">      i += 1;</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">59</td><td class="hits">11</td><td class="source">    if (!end.test(out)) {</td></tr><tr class="hit"><td class="line">60</td><td class="hits">1</td><td class="source">      throw new Error('Malformed arguments ' + out + ' sent to tag.');</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">63</td><td class="hits">10</td><td class="source">    return out.replace(/^ /, '');</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">66</td><td class="hits">238</td><td class="source">  for (i; i &lt; l; i += 1) {</td></tr><tr class="hit"><td class="line">67</td><td class="hits">425</td><td class="source">    arg = parts[i];</td></tr><tr class="hit"><td class="line">68</td><td class="hits">425</td><td class="source">    if (arg === null || (/^\s+$/).test(arg)) {</td></tr><tr class="hit"><td class="line">69</td><td class="hits">24</td><td class="source">      continue;</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">72</td><td class="hits">401</td><td class="source">    if (</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">      ((/^\&quot;/).test(arg) &amp;&amp; !(/\&quot;[\]\}]?$/).test(arg))</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">        || ((/^\'/).test(arg) &amp;&amp; !(/\'[\]\}]?$/).test(arg))</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">        || ((/^\{/).test(arg) &amp;&amp; !(/\}$/).test(arg))</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">        || ((/^\[/).test(arg) &amp;&amp; !(/\]$/).test(arg))</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">    ) {</td></tr><tr class="hit"><td class="line">78</td><td class="hits">11</td><td class="source">      switch (arg.substr(0, 1)) {</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">      case &quot;'&quot;:</td></tr><tr class="hit"><td class="line">80</td><td class="hits">1</td><td class="source">        ender = &quot;'&quot;;</td></tr><tr class="hit"><td class="line">81</td><td class="hits">1</td><td class="source">        break;</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">      case '&quot;':</td></tr><tr class="hit"><td class="line">83</td><td class="hits">3</td><td class="source">        ender = '&quot;';</td></tr><tr class="hit"><td class="line">84</td><td class="hits">3</td><td class="source">        break;</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">      case '[':</td></tr><tr class="hit"><td class="line">86</td><td class="hits">2</td><td class="source">        ender = ']';</td></tr><tr class="hit"><td class="line">87</td><td class="hits">2</td><td class="source">        break;</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">      case '{':</td></tr><tr class="hit"><td class="line">89</td><td class="hits">5</td><td class="source">        ender = '}';</td></tr><tr class="hit"><td class="line">90</td><td class="hits">5</td><td class="source">        break;</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">92</td><td class="hits">11</td><td class="source">      out.push(concat(i, ender));</td></tr><tr class="hit"><td class="line">93</td><td class="hits">10</td><td class="source">      continue;</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">96</td><td class="hits">390</td><td class="source">    out.push(arg);</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">99</td><td class="hits">237</td><td class="source">  return out;</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">102</td><td class="hits">1</td><td class="source">function findSubBlocks(topToken, blocks) {</td></tr><tr class="hit"><td class="line">103</td><td class="hits">52</td><td class="source">  _.each(topToken.tokens, function (token, index) {</td></tr><tr class="hit"><td class="line">104</td><td class="hits">81</td><td class="source">    if (token.name === 'block') {</td></tr><tr class="hit"><td class="line">105</td><td class="hits">10</td><td class="source">      blocks[token.args[0]] = token;</td></tr><tr class="hit"><td class="line">106</td><td class="hits">10</td><td class="source">      findSubBlocks(token, blocks);</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">111</td><td class="hits">1</td><td class="source">function getParentBlock(token) {</td></tr><tr class="hit"><td class="line">112</td><td class="hits">9</td><td class="source">  var block;</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">114</td><td class="hits">9</td><td class="source">  if (token.parentBlock) {</td></tr><tr class="hit"><td class="line">115</td><td class="hits">4</td><td class="source">    block = token.parentBlock;</td></tr><tr class="hit"><td class="line">116</td><td class="hits">5</td><td class="source">  } else if (token.parent) {</td></tr><tr class="hit"><td class="line">117</td><td class="hits">5</td><td class="source">    block = getParentBlock(_.last(token.parent));</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">120</td><td class="hits">9</td><td class="source">  return block;</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">123</td><td class="hits">1</td><td class="source">exports.parseVariable = function (token, escape) {</td></tr><tr class="hit"><td class="line">124</td><td class="hits">1108</td><td class="source">  if (!token) {</td></tr><tr class="miss"><td class="line">125</td><td class="hits">0</td><td class="source">    return {</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">      type: null,</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">      name: '',</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">      filters: [],</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">      escape: escape</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">133</td><td class="hits">1108</td><td class="source">  var filters = [],</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">    parts = token.replace(/^\{\{\s*|\s*\}\}$/g, '').split('|'),</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">    varname = parts.shift(),</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">    args = null,</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">    part;</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">139</td><td class="hits">1108</td><td class="source">  if ((/\(/).test(varname)) {</td></tr><tr class="hit"><td class="line">140</td><td class="hits">256</td><td class="source">    args = getArgs(varname.replace(/^\w+\./, ''));</td></tr><tr class="hit"><td class="line">141</td><td class="hits">256</td><td class="source">    varname = getMethod(varname);</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">144</td><td class="hits">873</td><td class="source">  _.each(parts, function (part, i) {</td></tr><tr class="hit"><td class="line">145</td><td class="hits">149</td><td class="source">    if (part &amp;&amp; ((/^[\w\.]+\(/).test(part) || (/\)$/).test(part)) &amp;&amp; !(/^[\w\.]+\([^\)]*\)$/).test(part)) {</td></tr><tr class="hit"><td class="line">146</td><td class="hits">3</td><td class="source">      parts[i] += ((parts[i + 1]) ? '|' + parts[i + 1] : '');</td></tr><tr class="hit"><td class="line">147</td><td class="hits">3</td><td class="source">      parts[i + 1] = false;</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">150</td><td class="hits">873</td><td class="source">  parts = _.without(parts, false);</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">152</td><td class="hits">873</td><td class="source">  _.each(parts, function (part) {</td></tr><tr class="hit"><td class="line">153</td><td class="hits">147</td><td class="source">    var filter_name = getMethod(part);</td></tr><tr class="hit"><td class="line">154</td><td class="hits">147</td><td class="source">    if ((/\(/).test(part)) {</td></tr><tr class="hit"><td class="line">155</td><td class="hits">96</td><td class="source">      filters.push({</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">        name: filter_name,</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">        args: getArgs(part)</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="hit"><td class="line">160</td><td class="hits">51</td><td class="source">      filters.push({ name: filter_name, args: '' });</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">163</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">164</td><td class="hits">873</td><td class="source">  return {</td></tr><tr><td class="line">165</td><td class="hits"></td><td class="source">    type: VAR_TOKEN,</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">    name: varname,</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">    args: args,</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source">    filters: filters,</td></tr><tr><td class="line">169</td><td class="hits"></td><td class="source">    escape: escape</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">173</td><td class="hits">1</td><td class="source">exports.parse = function (data, tags, autoescape) {</td></tr><tr class="hit"><td class="line">174</td><td class="hits">307</td><td class="source">  var rawtokens = helpers.stripWhitespace(data).split(/(\{%[^\r]*?%\}|\{\{.*?\}\}|\{#[^\r]*?#\})/),</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">    escape = !!autoescape,</td></tr><tr><td class="line">176</td><td class="hits"></td><td class="source">    last_escape = escape,</td></tr><tr><td class="line">177</td><td class="hits"></td><td class="source">    stack = [[]],</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">    index = 0,</td></tr><tr><td class="line">179</td><td class="hits"></td><td class="source">    i = 0,</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">    j = rawtokens.length,</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">    token,</td></tr><tr><td class="line">182</td><td class="hits"></td><td class="source">    parts,</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">    tagname,</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source">    lines = 1,</td></tr><tr><td class="line">185</td><td class="hits"></td><td class="source">    curline = 1,</td></tr><tr><td class="line">186</td><td class="hits"></td><td class="source">    newlines = null,</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source">    lastToken,</td></tr><tr><td class="line">188</td><td class="hits"></td><td class="source">    rawStart = /^\{\% *raw *\%\}/,</td></tr><tr><td class="line">189</td><td class="hits"></td><td class="source">    rawEnd = /\{\% *endraw *\%\}$/,</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source">    inRaw = false,</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source">    stripAfter = false,</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source">    stripBefore = false,</td></tr><tr><td class="line">193</td><td class="hits"></td><td class="source">    stripStart = false,</td></tr><tr><td class="line">194</td><td class="hits"></td><td class="source">    stripEnd = false;</td></tr><tr><td class="line">195</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">196</td><td class="hits">307</td><td class="source">  for (i; i &lt; j; i += 1) {</td></tr><tr class="hit"><td class="line">197</td><td class="hits">1515</td><td class="source">    token = rawtokens[i];</td></tr><tr class="hit"><td class="line">198</td><td class="hits">1515</td><td class="source">    curline = lines;</td></tr><tr class="hit"><td class="line">199</td><td class="hits">1515</td><td class="source">    newlines = token.match(/\n/g);</td></tr><tr class="hit"><td class="line">200</td><td class="hits">1515</td><td class="source">    stripAfter = false;</td></tr><tr class="hit"><td class="line">201</td><td class="hits">1515</td><td class="source">    stripBefore = false;</td></tr><tr class="hit"><td class="line">202</td><td class="hits">1515</td><td class="source">    stripStart = false;</td></tr><tr class="hit"><td class="line">203</td><td class="hits">1515</td><td class="source">    stripEnd = false;</td></tr><tr><td class="line">204</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">205</td><td class="hits">1515</td><td class="source">    if (newlines) {</td></tr><tr class="hit"><td class="line">206</td><td class="hits">114</td><td class="source">      lines += newlines.length;</td></tr><tr><td class="line">207</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">208</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">209</td><td class="hits">1515</td><td class="source">    if (inRaw !== false &amp;&amp; !rawEnd.test(token)) {</td></tr><tr class="hit"><td class="line">210</td><td class="hits">24</td><td class="source">      inRaw += token;</td></tr><tr class="hit"><td class="line">211</td><td class="hits">24</td><td class="source">      continue;</td></tr><tr><td class="line">212</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">213</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">214</td><td class="hits"></td><td class="source">    // Ignore empty strings and comments</td></tr><tr class="hit"><td class="line">215</td><td class="hits">1491</td><td class="source">    if (token.length === 0 || commentRegexp.test(token)) {</td></tr><tr class="hit"><td class="line">216</td><td class="hits">692</td><td class="source">      continue;</td></tr><tr class="hit"><td class="line">217</td><td class="hits">799</td><td class="source">    } else if (/^\s+$/.test(token)) {</td></tr><tr class="hit"><td class="line">218</td><td class="hits">46</td><td class="source">      token = token.replace(/ +/, ' ').replace(/\n+/, '\n');</td></tr><tr class="hit"><td class="line">219</td><td class="hits">753</td><td class="source">    } else if (variableRegexp.test(token)) {</td></tr><tr class="hit"><td class="line">220</td><td class="hits">206</td><td class="source">      token = exports.parseVariable(token, escape);</td></tr><tr class="hit"><td class="line">221</td><td class="hits">547</td><td class="source">    } else if (logicRegexp.test(token)) {</td></tr><tr class="hit"><td class="line">222</td><td class="hits">389</td><td class="source">      if (rawEnd.test(token)) {</td></tr><tr><td class="line">223</td><td class="hits"></td><td class="source">        // Don't care about the content in a raw tag, so end tag may not start correctly</td></tr><tr class="hit"><td class="line">224</td><td class="hits">3</td><td class="source">        token = inRaw + token.replace(rawEnd, '');</td></tr><tr class="hit"><td class="line">225</td><td class="hits">3</td><td class="source">        inRaw = false;</td></tr><tr class="hit"><td class="line">226</td><td class="hits">3</td><td class="source">        stack[index].push(token);</td></tr><tr class="hit"><td class="line">227</td><td class="hits">3</td><td class="source">        continue;</td></tr><tr><td class="line">228</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">229</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">230</td><td class="hits">386</td><td class="source">      if (rawStart.test(token)) {</td></tr><tr><td class="line">231</td><td class="hits"></td><td class="source">        // Have to check the whole token directly, not just parts, as the tag may not end correctly while in raw</td></tr><tr class="hit"><td class="line">232</td><td class="hits">4</td><td class="source">        inRaw = token.replace(rawStart, '');</td></tr><tr class="hit"><td class="line">233</td><td class="hits">4</td><td class="source">        continue;</td></tr><tr><td class="line">234</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">235</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">236</td><td class="hits">382</td><td class="source">      parts = token.replace(/^\{%\s*|\s*%\}$/g, '').split(' ');</td></tr><tr class="hit"><td class="line">237</td><td class="hits">382</td><td class="source">      if (parts[0] === '-') {</td></tr><tr class="hit"><td class="line">238</td><td class="hits">6</td><td class="source">        stripBefore = true;</td></tr><tr class="hit"><td class="line">239</td><td class="hits">6</td><td class="source">        parts.shift();</td></tr><tr><td class="line">240</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">241</td><td class="hits">382</td><td class="source">      tagname = parts.shift();</td></tr><tr class="hit"><td class="line">242</td><td class="hits">382</td><td class="source">      if (_.last(parts) === '-') {</td></tr><tr class="hit"><td class="line">243</td><td class="hits">5</td><td class="source">        stripAfter = true;</td></tr><tr class="hit"><td class="line">244</td><td class="hits">5</td><td class="source">        parts.pop();</td></tr><tr><td class="line">245</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">246</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">247</td><td class="hits">382</td><td class="source">      if (index &gt; 0 &amp;&amp; (/^end/).test(tagname)) {</td></tr><tr class="hit"><td class="line">248</td><td class="hits">142</td><td class="source">        lastToken = _.last(stack[stack.length - 2]);</td></tr><tr class="hit"><td class="line">249</td><td class="hits">142</td><td class="source">        if ('end' + lastToken.name === tagname) {</td></tr><tr class="hit"><td class="line">250</td><td class="hits">141</td><td class="source">          if (lastToken.name === 'autoescape') {</td></tr><tr class="hit"><td class="line">251</td><td class="hits">4</td><td class="source">            escape = last_escape;</td></tr><tr><td class="line">252</td><td class="hits"></td><td class="source">          }</td></tr><tr class="hit"><td class="line">253</td><td class="hits">141</td><td class="source">          lastToken.strip.end = stripBefore;</td></tr><tr class="hit"><td class="line">254</td><td class="hits">141</td><td class="source">          lastToken.strip.after = stripAfter;</td></tr><tr class="hit"><td class="line">255</td><td class="hits">141</td><td class="source">          stack.pop();</td></tr><tr class="hit"><td class="line">256</td><td class="hits">141</td><td class="source">          index -= 1;</td></tr><tr class="hit"><td class="line">257</td><td class="hits">141</td><td class="source">          continue;</td></tr><tr><td class="line">258</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">259</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">260</td><td class="hits">1</td><td class="source">        throw new Error('Expected end tag for &quot;' + lastToken.name + '&quot;, but found &quot;' + tagname + '&quot; at line ' + lines + '.');</td></tr><tr><td class="line">261</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">262</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">263</td><td class="hits">240</td><td class="source">      if (!tags.hasOwnProperty(tagname)) {</td></tr><tr class="hit"><td class="line">264</td><td class="hits">2</td><td class="source">        throw new Error('Unknown logic tag at line ' + lines + ': &quot;' + tagname + '&quot;.');</td></tr><tr><td class="line">265</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">266</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">267</td><td class="hits">238</td><td class="source">      if (tagname === 'autoescape') {</td></tr><tr class="hit"><td class="line">268</td><td class="hits">4</td><td class="source">        last_escape = escape;</td></tr><tr class="hit"><td class="line">269</td><td class="hits">4</td><td class="source">        escape = (!parts.length || parts[0] === 'true') ? ((parts.length &gt;= 2) ? parts[1] : true) : false;</td></tr><tr><td class="line">270</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">271</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">272</td><td class="hits">238</td><td class="source">      token = {</td></tr><tr><td class="line">273</td><td class="hits"></td><td class="source">        type: LOGIC_TOKEN,</td></tr><tr><td class="line">274</td><td class="hits"></td><td class="source">        line: curline,</td></tr><tr><td class="line">275</td><td class="hits"></td><td class="source">        name: tagname,</td></tr><tr><td class="line">276</td><td class="hits"></td><td class="source">        compile: tags[tagname],</td></tr><tr><td class="line">277</td><td class="hits"></td><td class="source">        parent: _.uniq(stack[stack.length - 2] || []),</td></tr><tr><td class="line">278</td><td class="hits"></td><td class="source">        strip: {</td></tr><tr><td class="line">279</td><td class="hits"></td><td class="source">          before: stripBefore,</td></tr><tr><td class="line">280</td><td class="hits"></td><td class="source">          after: stripAfter,</td></tr><tr><td class="line">281</td><td class="hits"></td><td class="source">          start: false,</td></tr><tr><td class="line">282</td><td class="hits"></td><td class="source">          end: false</td></tr><tr><td class="line">283</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">284</td><td class="hits"></td><td class="source">      };</td></tr><tr class="hit"><td class="line">285</td><td class="hits">238</td><td class="source">      token.args = getTokenArgs(token, parts);</td></tr><tr><td class="line">286</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">287</td><td class="hits">237</td><td class="source">      if (tags[tagname].ends) {</td></tr><tr class="hit"><td class="line">288</td><td class="hits">143</td><td class="source">        token.strip.after = false;</td></tr><tr class="hit"><td class="line">289</td><td class="hits">143</td><td class="source">        token.strip.start = stripAfter;</td></tr><tr class="hit"><td class="line">290</td><td class="hits">143</td><td class="source">        stack[index].push(token);</td></tr><tr class="hit"><td class="line">291</td><td class="hits">143</td><td class="source">        stack.push(token.tokens = []);</td></tr><tr class="hit"><td class="line">292</td><td class="hits">143</td><td class="source">        index += 1;</td></tr><tr class="hit"><td class="line">293</td><td class="hits">143</td><td class="source">        continue;</td></tr><tr><td class="line">294</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">295</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">296</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">297</td><td class="hits"></td><td class="source">    // Everything else is treated as a string</td></tr><tr class="hit"><td class="line">298</td><td class="hits">504</td><td class="source">    stack[index].push(token);</td></tr><tr><td class="line">299</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">300</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">301</td><td class="hits">303</td><td class="source">  if (inRaw !== false) {</td></tr><tr class="hit"><td class="line">302</td><td class="hits">1</td><td class="source">    throw new Error('Missing expected end tag for &quot;raw&quot; on line ' + curline + '.');</td></tr><tr><td class="line">303</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">304</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">305</td><td class="hits">302</td><td class="source">  if (index !== 0) {</td></tr><tr class="hit"><td class="line">306</td><td class="hits">1</td><td class="source">    lastToken = _.last(stack[stack.length - 2]);</td></tr><tr class="hit"><td class="line">307</td><td class="hits">1</td><td class="source">    throw new Error('Missing end tag for &quot;' + lastToken.name + '&quot; that was opened on line ' + lastToken.line + '.');</td></tr><tr><td class="line">308</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">309</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">310</td><td class="hits">301</td><td class="source">  return stack[index];</td></tr><tr><td class="line">311</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">312</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">313</td><td class="hits">1</td><td class="source">function precompile(indent, context) {</td></tr><tr class="hit"><td class="line">314</td><td class="hits">406</td><td class="source">  var filepath,</td></tr><tr><td class="line">315</td><td class="hits"></td><td class="source">    extendsHasVar,</td></tr><tr><td class="line">316</td><td class="hits"></td><td class="source">    preservedTokens = [];</td></tr><tr><td class="line">317</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">318</td><td class="hits"></td><td class="source">  // Precompile - extract blocks and create hierarchy based on 'extends' tags</td></tr><tr><td class="line">319</td><td class="hits"></td><td class="source">  // TODO: make block and extends tags accept context variables</td></tr><tr><td class="line">320</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">321</td><td class="hits"></td><td class="source">  // Only precompile at the template level</td></tr><tr class="hit"><td class="line">322</td><td class="hits">406</td><td class="source">  if (this.type === TEMPLATE) {</td></tr><tr><td class="line">323</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">324</td><td class="hits">248</td><td class="source">    _.each(this.tokens, function (token, index) {</td></tr><tr><td class="line">325</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">326</td><td class="hits">382</td><td class="source">      if (!extendsHasVar) {</td></tr><tr><td class="line">327</td><td class="hits"></td><td class="source">        // Load the parent template</td></tr><tr class="hit"><td class="line">328</td><td class="hits">382</td><td class="source">        if (token.name === 'extends') {</td></tr><tr class="hit"><td class="line">329</td><td class="hits">22</td><td class="source">          filepath = token.args[0];</td></tr><tr><td class="line">330</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">331</td><td class="hits">22</td><td class="source">          if (!helpers.isStringLiteral(filepath)) {</td></tr><tr><td class="line">332</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">333</td><td class="hits">2</td><td class="source">            if (!context) {</td></tr><tr class="hit"><td class="line">334</td><td class="hits">2</td><td class="source">              extendsHasVar = true;</td></tr><tr class="hit"><td class="line">335</td><td class="hits">2</td><td class="source">              return;</td></tr><tr><td class="line">336</td><td class="hits"></td><td class="source">            }</td></tr><tr class="miss"><td class="line">337</td><td class="hits">0</td><td class="source">            filepath = &quot;\&quot;&quot; + getContextVar(filepath, context) + &quot;\&quot;&quot;;</td></tr><tr><td class="line">338</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">339</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">340</td><td class="hits">20</td><td class="source">          if (!helpers.isStringLiteral(filepath) || token.args.length &gt; 1) {</td></tr><tr class="hit"><td class="line">341</td><td class="hits">1</td><td class="source">            throw new Error('Extends tag on line ' + token.line + ' accepts exactly one string literal as an argument.');</td></tr><tr><td class="line">342</td><td class="hits"></td><td class="source">          }</td></tr><tr class="hit"><td class="line">343</td><td class="hits">19</td><td class="source">          if (index &gt; 0) {</td></tr><tr class="hit"><td class="line">344</td><td class="hits">1</td><td class="source">            throw new Error('Extends tag must be the first tag in the template, but &quot;extends&quot; found on line ' + token.line + '.');</td></tr><tr><td class="line">345</td><td class="hits"></td><td class="source">          }</td></tr><tr class="hit"><td class="line">346</td><td class="hits">18</td><td class="source">          token.template = this.compileFile(filepath.replace(/['&quot;]/g, ''), true);</td></tr><tr class="hit"><td class="line">347</td><td class="hits">17</td><td class="source">          this.parent = token.template;</td></tr><tr><td class="line">348</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">349</td><td class="hits"></td><td class="source">          // inherit tokens/blocks from parent.</td></tr><tr class="hit"><td class="line">350</td><td class="hits">17</td><td class="source">          this.blocks = _.extend({}, this.parent.blocks, this.blocks);</td></tr><tr><td class="line">351</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">352</td><td class="hits">360</td><td class="source">        } else if (token.name === 'block') { // Make a list of blocks</td></tr><tr class="hit"><td class="line">353</td><td class="hits">43</td><td class="source">          var blockname = token.args[0],</td></tr><tr><td class="line">354</td><td class="hits"></td><td class="source">            parentBlockIndex;</td></tr><tr><td class="line">355</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">356</td><td class="hits">43</td><td class="source">          if (!helpers.isValidBlockName(blockname) || token.args.length !== 1) {</td></tr><tr class="hit"><td class="line">357</td><td class="hits">1</td><td class="source">            throw new Error('Invalid block tag name &quot;' + blockname + '&quot; on line ' + token.line + '.');</td></tr><tr><td class="line">358</td><td class="hits"></td><td class="source">          }</td></tr><tr><td class="line">359</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">360</td><td class="hits"></td><td class="source">          // store blocks as flat reference list on top-level</td></tr><tr><td class="line">361</td><td class="hits"></td><td class="source">          // template object</td></tr><tr class="hit"><td class="line">362</td><td class="hits">42</td><td class="source">          this.blocks[blockname] = token;</td></tr><tr><td class="line">363</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">364</td><td class="hits"></td><td class="source">          // child tokens may contain more blocks at this template</td></tr><tr><td class="line">365</td><td class="hits"></td><td class="source">          // level - apply to flat this.blocks object</td></tr><tr class="hit"><td class="line">366</td><td class="hits">42</td><td class="source">          findSubBlocks(token, this.blocks);</td></tr><tr><td class="line">367</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">368</td><td class="hits"></td><td class="source">          // search parent list for a matching block, replacing the</td></tr><tr><td class="line">369</td><td class="hits"></td><td class="source">          // parent template block tokens with the derived token.</td></tr><tr class="hit"><td class="line">370</td><td class="hits">42</td><td class="source">          if (this.parent) {</td></tr><tr><td class="line">371</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">372</td><td class="hits"></td><td class="source">            // Store parent token object on a derived block</td></tr><tr class="hit"><td class="line">373</td><td class="hits">14</td><td class="source">            token.parentBlock = this.parent.blocks[blockname];</td></tr><tr><td class="line">374</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">375</td><td class="hits"></td><td class="source">            // this will return -1 for a nested block</td></tr><tr class="hit"><td class="line">376</td><td class="hits">14</td><td class="source">            parentBlockIndex = _.indexOf(this.parent.tokens,</td></tr><tr><td class="line">377</td><td class="hits"></td><td class="source">                this.parent.blocks[blockname]);</td></tr><tr class="hit"><td class="line">378</td><td class="hits">14</td><td class="source">            if (parentBlockIndex &gt;= 0) {</td></tr><tr class="hit"><td class="line">379</td><td class="hits">10</td><td class="source">              this.parent.tokens[parentBlockIndex] = token;</td></tr><tr><td class="line">380</td><td class="hits"></td><td class="source">            }</td></tr><tr><td class="line">381</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">382</td><td class="hits"></td><td class="source">          }</td></tr><tr class="hit"><td class="line">383</td><td class="hits">317</td><td class="source">        } else if (token.type === LOGIC_TOKEN) {</td></tr><tr><td class="line">384</td><td class="hits"></td><td class="source">          // Preserve any template logic from the extended template.</td></tr><tr class="hit"><td class="line">385</td><td class="hits">113</td><td class="source">          preservedTokens.push(token);</td></tr><tr><td class="line">386</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">387</td><td class="hits"></td><td class="source">        // else, discard any tokens that are not under a LOGIC_TOKEN</td></tr><tr><td class="line">388</td><td class="hits"></td><td class="source">        // or VAR_TOKEN (for example, static strings).</td></tr><tr><td class="line">389</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">390</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">391</td><td class="hits"></td><td class="source">    }, this);</td></tr><tr><td class="line">392</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">393</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">394</td><td class="hits"></td><td class="source">    // If extendsHasVar == true, then we know {% extends %} is not using a string literal, thus we can't</td></tr><tr><td class="line">395</td><td class="hits"></td><td class="source">    // compile until render is called, so we return false.</td></tr><tr class="hit"><td class="line">396</td><td class="hits">244</td><td class="source">    if (extendsHasVar) {</td></tr><tr class="hit"><td class="line">397</td><td class="hits">2</td><td class="source">      return false;</td></tr><tr><td class="line">398</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">399</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">400</td><td class="hits">242</td><td class="source">    if (this.parent &amp;&amp; this.parent.tokens) {</td></tr><tr class="hit"><td class="line">401</td><td class="hits">17</td><td class="source">      this.tokens = preservedTokens.concat(this.parent.tokens);</td></tr><tr><td class="line">402</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">403</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">404</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">405</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">406</td><td class="hits">1</td><td class="source">exports.compile = function compile(indent, context, template) {</td></tr><tr class="hit"><td class="line">407</td><td class="hits">406</td><td class="source">  var code = '',</td></tr><tr><td class="line">408</td><td class="hits"></td><td class="source">    wrappedInMethod,</td></tr><tr><td class="line">409</td><td class="hits"></td><td class="source">    blockname,</td></tr><tr><td class="line">410</td><td class="hits"></td><td class="source">    parentBlock;</td></tr><tr><td class="line">411</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">412</td><td class="hits">406</td><td class="source">  indent = indent || '';</td></tr><tr><td class="line">413</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">414</td><td class="hits"></td><td class="source">  // Template parameter is optional (not used at the top-level), initialize</td></tr><tr class="hit"><td class="line">415</td><td class="hits">406</td><td class="source">  if (this.type === TEMPLATE) {</td></tr><tr class="hit"><td class="line">416</td><td class="hits">248</td><td class="source">    template = this;</td></tr><tr><td class="line">417</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">418</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">419</td><td class="hits"></td><td class="source">  // Initialize blocks</td></tr><tr class="hit"><td class="line">420</td><td class="hits">406</td><td class="source">  if (!this.blocks) {</td></tr><tr class="hit"><td class="line">421</td><td class="hits">140</td><td class="source">    this.blocks = {};</td></tr><tr><td class="line">422</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">423</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">424</td><td class="hits"></td><td class="source">  // Precompile step - process block inheritence into true token hierarchy</td></tr><tr class="hit"><td class="line">425</td><td class="hits">406</td><td class="source">  if (precompile.call(this, indent, context) === false) {</td></tr><tr class="hit"><td class="line">426</td><td class="hits">2</td><td class="source">    return false;</td></tr><tr><td class="line">427</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">428</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">429</td><td class="hits"></td><td class="source">  // If this is not a template then just iterate through its tokens</td></tr><tr class="hit"><td class="line">430</td><td class="hits">400</td><td class="source">  _.each(this.tokens, function (token, index) {</td></tr><tr class="hit"><td class="line">431</td><td class="hits">643</td><td class="source">    var name, key, args, prev, next;</td></tr><tr class="hit"><td class="line">432</td><td class="hits">643</td><td class="source">    if (typeof token === 'string') {</td></tr><tr class="hit"><td class="line">433</td><td class="hits">242</td><td class="source">      prev = this.tokens[index - 1];</td></tr><tr class="hit"><td class="line">434</td><td class="hits">242</td><td class="source">      next = this.tokens[index + 1];</td></tr><tr class="hit"><td class="line">435</td><td class="hits">242</td><td class="source">      if (prev &amp;&amp; prev.strip &amp;&amp; prev.strip.after) {</td></tr><tr class="hit"><td class="line">436</td><td class="hits">1</td><td class="source">        token = token.replace(/^\s+/, '');</td></tr><tr><td class="line">437</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">438</td><td class="hits">242</td><td class="source">      if (next &amp;&amp; next.strip &amp;&amp; next.strip.before) {</td></tr><tr class="hit"><td class="line">439</td><td class="hits">2</td><td class="source">        token = token.replace(/\s+$/, '');</td></tr><tr><td class="line">440</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">441</td><td class="hits">242</td><td class="source">      code += '_output += &quot;' + doubleEscape(token).replace(/\n/g, '\\n').replace(/\r/g, '\\r').replace(/&quot;/g, '\\&quot;') + '&quot;;\n';</td></tr><tr class="hit"><td class="line">442</td><td class="hits">242</td><td class="source">      return code;</td></tr><tr><td class="line">443</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">444</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">445</td><td class="hits">401</td><td class="source">    if (typeof token !== 'object') {</td></tr><tr class="miss"><td class="line">446</td><td class="hits">0</td><td class="source">      return; // Tokens can be either strings or objects</td></tr><tr><td class="line">447</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">448</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">449</td><td class="hits">401</td><td class="source">    if (token.type === VAR_TOKEN) {</td></tr><tr class="hit"><td class="line">450</td><td class="hits">188</td><td class="source">      name = token.name.replace(/\W/g, '_');</td></tr><tr class="hit"><td class="line">451</td><td class="hits">188</td><td class="source">      key = (helpers.isLiteral(name)) ? '[&quot;' + name + '&quot;]' : '.' + name;</td></tr><tr class="hit"><td class="line">452</td><td class="hits">188</td><td class="source">      args = (token.args &amp;&amp; token.args.length) ? token.args : '';</td></tr><tr><td class="line">453</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">454</td><td class="hits">188</td><td class="source">      code += 'if (typeof _context !== &quot;undefined&quot; &amp;&amp; typeof _context' + key + ' === &quot;function&quot;) {\n';</td></tr><tr class="hit"><td class="line">455</td><td class="hits">188</td><td class="source">      wrappedInMethod = helpers.wrapMethod('', { name: name, args: args }, '_context');</td></tr><tr class="hit"><td class="line">456</td><td class="hits">188</td><td class="source">      code += '  _output = (typeof _output === &quot;undefined&quot;) ? ' + wrappedInMethod + ': _output + ' + wrappedInMethod + ';\n';</td></tr><tr class="hit"><td class="line">457</td><td class="hits">188</td><td class="source">      if (helpers.isValidName(name)) {</td></tr><tr class="hit"><td class="line">458</td><td class="hits">188</td><td class="source">        code += '} else if (typeof ' + name + ' === &quot;function&quot;) {\n';</td></tr><tr class="hit"><td class="line">459</td><td class="hits">188</td><td class="source">        wrappedInMethod = helpers.wrapMethod('', { name: name, args: args });</td></tr><tr class="hit"><td class="line">460</td><td class="hits">188</td><td class="source">        code += '  _output = (typeof _output === &quot;undefined&quot;) ? ' + wrappedInMethod + ': _output + ' + wrappedInMethod + ';\n';</td></tr><tr><td class="line">461</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">462</td><td class="hits">188</td><td class="source">      code += '} else {\n';</td></tr><tr class="hit"><td class="line">463</td><td class="hits">188</td><td class="source">      code += helpers.setVar('__' + name, token, args);</td></tr><tr class="hit"><td class="line">464</td><td class="hits">187</td><td class="source">      code += '  _output = (typeof _output === &quot;undefined&quot;) ? __' + name + ': _output + __' + name + ';\n';</td></tr><tr class="hit"><td class="line">465</td><td class="hits">187</td><td class="source">      code += '}\n';</td></tr><tr><td class="line">466</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">467</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">468</td><td class="hits">400</td><td class="source">    if (token.type !== LOGIC_TOKEN) {</td></tr><tr class="hit"><td class="line">469</td><td class="hits">187</td><td class="source">      return; // Tokens can be either VAR_TOKEN or LOGIC_TOKEN</td></tr><tr><td class="line">470</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">471</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">472</td><td class="hits">213</td><td class="source">    if (token.name === 'block') {</td></tr><tr class="hit"><td class="line">473</td><td class="hits">69</td><td class="source">      blockname = token.args[0];</td></tr><tr><td class="line">474</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">475</td><td class="hits"></td><td class="source">      // Sanity check - the template should be in the flat block list.</td></tr><tr class="hit"><td class="line">476</td><td class="hits">69</td><td class="source">      if (!template.blocks.hasOwnProperty(blockname)) {</td></tr><tr class="miss"><td class="line">477</td><td class="hits">0</td><td class="source">        throw new Error('Unrecognized nested block.  Block \&quot;' + blockname +</td></tr><tr><td class="line">478</td><td class="hits"></td><td class="source">                '\&quot; at line ' + token.line + ' of \&quot;' + template.id +</td></tr><tr><td class="line">479</td><td class="hits"></td><td class="source">                '\&quot; is not in template block list.');</td></tr><tr><td class="line">480</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">481</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">482</td><td class="hits">69</td><td class="source">      code += compile.call(template.blocks[token.args[0]], indent + '  ', context, template);</td></tr><tr class="hit"><td class="line">483</td><td class="hits">144</td><td class="source">    } else if (token.name === 'parent') {</td></tr><tr class="hit"><td class="line">484</td><td class="hits">4</td><td class="source">      parentBlock = getParentBlock(token);</td></tr><tr class="hit"><td class="line">485</td><td class="hits">4</td><td class="source">      if (!parentBlock) {</td></tr><tr class="miss"><td class="line">486</td><td class="hits">0</td><td class="source">        throw new Error('No parent block found for parent tag at line ' +</td></tr><tr><td class="line">487</td><td class="hits"></td><td class="source">                token.line + '.');</td></tr><tr><td class="line">488</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">489</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">490</td><td class="hits">4</td><td class="source">      code += compile.call(parentBlock, indent + '  ', context);</td></tr><tr class="hit"><td class="line">491</td><td class="hits">140</td><td class="source">    } else if (token.hasOwnProperty(&quot;compile&quot;)) {</td></tr><tr class="hit"><td class="line">492</td><td class="hits">140</td><td class="source">      if (token.strip.start &amp;&amp; token.tokens.length &amp;&amp; typeof token.tokens[0] === 'string') {</td></tr><tr class="hit"><td class="line">493</td><td class="hits">4</td><td class="source">        token.tokens[0] = token.tokens[0].replace(/^\s+/, '');</td></tr><tr><td class="line">494</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">495</td><td class="hits">140</td><td class="source">      if (token.strip.end &amp;&amp; token.tokens.length &amp;&amp; typeof _.last(token.tokens) === 'string') {</td></tr><tr class="hit"><td class="line">496</td><td class="hits">3</td><td class="source">        token.tokens[token.tokens.length - 1] = _.last(token.tokens).replace(/\s+$/, '');</td></tr><tr><td class="line">497</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">498</td><td class="hits">140</td><td class="source">      code += token.compile(indent + '  ', exports);</td></tr><tr><td class="line">499</td><td class="hits"></td><td class="source">    } else {</td></tr><tr class="miss"><td class="line">500</td><td class="hits">0</td><td class="source">      code += compile.call(token, indent + '  ', context);</td></tr><tr><td class="line">501</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">502</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">503</td><td class="hits"></td><td class="source">  }, this);</td></tr><tr><td class="line">504</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">505</td><td class="hits">390</td><td class="source">  return code;</td></tr><tr><td class="line">506</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">507</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">508</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/swig.js">/lib/swig.js</h2><div id="stats" class="high"><div class="percentage">94%</div><div class="sloc">76</div><div class="hits">72</div><div class="misses">4</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var fs = require('fs'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  path = require('path'),</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">  tags = require('./tags'),</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">  parser = require('./parser'),</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">  filters = require('./filters'),</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">  helpers = require('./helpers'),</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">  dateformat = require('./dateformat'),</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">  _ = require('underscore');</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var config = {</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">    allowErrors: false,</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">    autoescape: true,</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">    cache: true,</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">    encoding: 'utf8',</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">    filters: filters,</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">    root: '/',</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">    tags: tags,</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">    extensions: {},</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">    tzOffset: 0</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  _config = _.extend({}, config),</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  CACHE = {};</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">// Call this before using the templates</td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">exports.init = function (options) {</td></tr><tr class="hit"><td class="line">28</td><td class="hits">130</td><td class="source">  CACHE = {};</td></tr><tr class="hit"><td class="line">29</td><td class="hits">130</td><td class="source">  _config = _.extend({}, config, options);</td></tr><tr class="hit"><td class="line">30</td><td class="hits">130</td><td class="source">  _config.filters = _.extend(filters, options.filters);</td></tr><tr class="hit"><td class="line">31</td><td class="hits">130</td><td class="source">  _config.tags = _.extend(tags, options.tags);</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">33</td><td class="hits">130</td><td class="source">  dateformat.defaultTZOffset = _config.tzOffset;</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">function TemplateError(error) {</td></tr><tr class="hit"><td class="line">37</td><td class="hits">3</td><td class="source">  return { render: function () {</td></tr><tr class="hit"><td class="line">38</td><td class="hits">2</td><td class="source">    return '&lt;pre&gt;' + error.stack + '&lt;/pre&gt;';</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">  }};</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">function createRenderFunc(code) {</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">  // The compiled render function - this is all we need</td></tr><tr class="hit"><td class="line">44</td><td class="hits">233</td><td class="source">  return new Function('_context', '_parents', '_filters', '_', '_ext', [</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">    '_parents = _parents ? _parents.slice() : [];',</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    '_context = _context || {};',</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">    // Prevents circular includes (which will crash node without warning)</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">    'var j = _parents.length,',</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">    '  _output = &quot;&quot;,',</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">    '  _this = this;',</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">    // Note: this loop averages much faster than indexOf across all cases</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">    'while (j--) {',</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">    '   if (_parents[j] === this.id) {',</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">    '     return &quot;Circular import of template &quot; + this.id + &quot; in &quot; + _parents[_parents.length-1];',</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">    '   }',</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">    '}',</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">    // Add this template as a parent to all includes in its scope</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">    '_parents.push(this.id);',</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">    code,</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">    'return _output;'</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">  ].join(''));</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">64</td><td class="hits">1</td><td class="source">function createTemplate(data, id) {</td></tr><tr class="hit"><td class="line">65</td><td class="hits">244</td><td class="source">  var template = {</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">      // Allows us to include templates from the compiled code</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">      compileFile: exports.compileFile,</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">      // These are the blocks inside the template</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">      blocks: {},</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">      // Distinguish from other tokens</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">      type: parser.TEMPLATE,</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">      // The template ID (path relative to template dir)</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">      id: id</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">    tokens,</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">    code,</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">    render;</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">  // The template token tree before compiled into javascript</td></tr><tr class="hit"><td class="line">80</td><td class="hits">244</td><td class="source">  if (_config.allowErrors) {</td></tr><tr class="hit"><td class="line">81</td><td class="hits">193</td><td class="source">    tokens = parser.parse.call(template, data, _config.tags, _config.autoescape);</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">83</td><td class="hits">51</td><td class="source">    try {</td></tr><tr class="hit"><td class="line">84</td><td class="hits">51</td><td class="source">      tokens = parser.parse.call(template, data, _config.tags, _config.autoescape);</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">    } catch (e) {</td></tr><tr class="miss"><td class="line">86</td><td class="hits">0</td><td class="source">      return new TemplateError(e);</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">90</td><td class="hits">243</td><td class="source">  template.tokens = tokens;</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">  // The raw template code</td></tr><tr class="hit"><td class="line">93</td><td class="hits">243</td><td class="source">  code = parser.compile.call(template);</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">95</td><td class="hits">233</td><td class="source">  if (code !== false) {</td></tr><tr class="hit"><td class="line">96</td><td class="hits">232</td><td class="source">    render = createRenderFunc(code);</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">98</td><td class="hits">1</td><td class="source">    render = function (_context, _parents, _filters, _, _ext) {</td></tr><tr class="hit"><td class="line">99</td><td class="hits">1</td><td class="source">      template.tokens = tokens;</td></tr><tr class="hit"><td class="line">100</td><td class="hits">1</td><td class="source">      code = parser.compile.call(template, '', _context);</td></tr><tr class="hit"><td class="line">101</td><td class="hits">1</td><td class="source">      var fn = createRenderFunc(code);</td></tr><tr class="miss"><td class="line">102</td><td class="hits">0</td><td class="source">      return fn.call(this, _context, _parents, _filters, _, _ext);</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">106</td><td class="hits">233</td><td class="source">  template.render = function (context, parents) {</td></tr><tr class="hit"><td class="line">107</td><td class="hits">287</td><td class="source">    if (_config.allowErrors) {</td></tr><tr class="hit"><td class="line">108</td><td class="hits">236</td><td class="source">      return render.call(this, context, parents, _config.filters, _, _config.extensions);</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">110</td><td class="hits">51</td><td class="source">    try {</td></tr><tr class="hit"><td class="line">111</td><td class="hits">51</td><td class="source">      return render.call(this, context, parents, _config.filters, _, _config.extensions);</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source">    } catch (e) {</td></tr><tr class="miss"><td class="line">113</td><td class="hits">0</td><td class="source">      return new TemplateError(e);</td></tr><tr><td class="line">114</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">117</td><td class="hits">233</td><td class="source">  return template;</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">120</td><td class="hits">1</td><td class="source">function getTemplate(source, options) {</td></tr><tr class="hit"><td class="line">121</td><td class="hits">293</td><td class="source">  var key = options.filename || source;</td></tr><tr class="hit"><td class="line">122</td><td class="hits">293</td><td class="source">  if (_config.cache || options.cache) {</td></tr><tr class="hit"><td class="line">123</td><td class="hits">293</td><td class="source">    if (!CACHE.hasOwnProperty(key)) {</td></tr><tr class="hit"><td class="line">124</td><td class="hits">244</td><td class="source">      CACHE[key] = createTemplate(source, key);</td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">127</td><td class="hits">282</td><td class="source">    return CACHE[key];</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">130</td><td class="hits">0</td><td class="source">  return createTemplate(source, key);</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">133</td><td class="hits">1</td><td class="source">exports.compileFile = function (filepath, forceAllowErrors) {</td></tr><tr class="hit"><td class="line">134</td><td class="hits">39</td><td class="source">  var tpl, get;</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">136</td><td class="hits">39</td><td class="source">  if (_config.cache &amp;&amp; CACHE.hasOwnProperty(filepath)) {</td></tr><tr class="hit"><td class="line">137</td><td class="hits">24</td><td class="source">    return CACHE[filepath];</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">140</td><td class="hits">15</td><td class="source">  if (typeof window !== 'undefined') {</td></tr><tr class="hit"><td class="line">141</td><td class="hits">1</td><td class="source">    throw new TemplateError({ stack: 'You must pre-compile all templates in-browser. Use `swig.compile(template);`.' });</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">144</td><td class="hits">14</td><td class="source">  get = function () {</td></tr><tr class="hit"><td class="line">145</td><td class="hits">14</td><td class="source">    var excp,</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">      getSingle,</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">      c;</td></tr><tr class="hit"><td class="line">148</td><td class="hits">14</td><td class="source">    getSingle = function (prefix) {</td></tr><tr class="hit"><td class="line">149</td><td class="hits">16</td><td class="source">      var file = ((/^\//).test(filepath) || (/^.:/).test(filepath)) ? filepath : prefix + '/' + filepath,</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">        data;</td></tr><tr class="hit"><td class="line">151</td><td class="hits">16</td><td class="source">      try {</td></tr><tr class="hit"><td class="line">152</td><td class="hits">16</td><td class="source">        data = fs.readFileSync(file, config.encoding);</td></tr><tr class="hit"><td class="line">153</td><td class="hits">8</td><td class="source">        tpl = getTemplate(data, { filename: filepath });</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source">      } catch (e) {</td></tr><tr class="hit"><td class="line">155</td><td class="hits">8</td><td class="source">        excp = e;</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">    };</td></tr><tr class="hit"><td class="line">158</td><td class="hits">14</td><td class="source">    if (typeof _config.root === &quot;string&quot;) {</td></tr><tr class="hit"><td class="line">159</td><td class="hits">12</td><td class="source">      getSingle(_config.root);</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">161</td><td class="hits">14</td><td class="source">    if (_config.root instanceof Array) {</td></tr><tr class="hit"><td class="line">162</td><td class="hits">2</td><td class="source">      c = 0;</td></tr><tr class="hit"><td class="line">163</td><td class="hits">2</td><td class="source">      while (tpl === undefined &amp;&amp; c &lt; _config.root.length) {</td></tr><tr class="hit"><td class="line">164</td><td class="hits">4</td><td class="source">        getSingle(_config.root[c]);</td></tr><tr class="hit"><td class="line">165</td><td class="hits">4</td><td class="source">        c = c + 1;</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">168</td><td class="hits">14</td><td class="source">    if (tpl === undefined) {</td></tr><tr class="hit"><td class="line">169</td><td class="hits">6</td><td class="source">      throw excp;</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">171</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">172</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">173</td><td class="hits">14</td><td class="source">  if (_config.allowErrors || forceAllowErrors) {</td></tr><tr class="hit"><td class="line">174</td><td class="hits">9</td><td class="source">    get();</td></tr><tr><td class="line">175</td><td class="hits"></td><td class="source">  } else {</td></tr><tr class="hit"><td class="line">176</td><td class="hits">5</td><td class="source">    try {</td></tr><tr class="hit"><td class="line">177</td><td class="hits">5</td><td class="source">      get();</td></tr><tr><td class="line">178</td><td class="hits"></td><td class="source">    } catch (error) {</td></tr><tr class="hit"><td class="line">179</td><td class="hits">2</td><td class="source">      tpl = new TemplateError(error);</td></tr><tr><td class="line">180</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">181</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">182</td><td class="hits">10</td><td class="source">  return tpl;</td></tr><tr><td class="line">183</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">184</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">185</td><td class="hits">1</td><td class="source">exports.compile = function (source, options) {</td></tr><tr class="hit"><td class="line">186</td><td class="hits">285</td><td class="source">  var tmpl = getTemplate(source, options || {});</td></tr><tr><td class="line">187</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">188</td><td class="hits">274</td><td class="source">  return function (source, options) {</td></tr><tr class="hit"><td class="line">189</td><td class="hits">272</td><td class="source">    return tmpl.render(source, options);</td></tr><tr><td class="line">190</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">191</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">192</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags.js">/lib/tags.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">2</div><div class="hits">2</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var _ = require('underscore');</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">_.extend(exports, {</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">  autoescape: require('./tags/autoescape'),</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">  block: require('./tags/block'),</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">  'else': require('./tags/else'),</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">  'extends': require('./tags/extends'),</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">  filter: require('./tags/filter'),</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">  'for': require('./tags/for'),</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">  'if': require('./tags/if'),</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">  'import': require('./tags/import'),</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">  include: require('./tags/include'),</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  macro: require('./tags/macro'),</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  parent: require('./tags/parent'),</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  raw: require('./tags/raw'),</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  set: require('./tags/set'),</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  spaceless: require('./tags/spaceless')</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/autoescape.js">/lib/tags/autoescape.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">3</div><div class="hits">3</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * autoescape</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Special handling hardcoded into the parser to determine whether variable output should be escaped or not</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">module.exports = function (indent, parser) {</td></tr><tr class="hit"><td class="line">6</td><td class="hits">4</td><td class="source">  return parser.compile.apply(this, [indent]);</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">module.exports.ends = true;</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/block.js">/lib/tags/block.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * block</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">module.exports = { ends: true };</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/else.js">/lib/tags/else.js</h2><div id="stats" class="high"><div class="percentage">96%</div><div class="sloc">26</div><div class="hits">25</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var helpers = require('../helpers'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  _ = require('underscore');</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * else</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">module.exports = function (indent, parser) {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">13</td><td class="source">  var last = _.last(this.parent).name,</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    thisArgs = _.clone(this.args),</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">    ifarg,</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">    args,</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">    out;</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">12</td><td class="source">  if (last === 'for') {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">2</td><td class="source">    if (thisArgs.length) {</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">      throw new Error('&quot;else&quot; tag cannot accept arguments in the &quot;for&quot; context.');</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">    return '} if (__loopLength === 0) {\n';</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">10</td><td class="source">  if (last !== 'if') {</td></tr><tr class="miss"><td class="line">22</td><td class="hits">0</td><td class="source">    throw new Error('Cannot call else tag outside of &quot;if&quot; or &quot;for&quot; context.');</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">25</td><td class="hits">10</td><td class="source">  ifarg = thisArgs.shift();</td></tr><tr class="hit"><td class="line">26</td><td class="hits">10</td><td class="source">  args = (helpers.parseIfArgs(thisArgs, parser));</td></tr><tr class="hit"><td class="line">27</td><td class="hits">10</td><td class="source">  out = '';</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">29</td><td class="hits">10</td><td class="source">  if (ifarg) {</td></tr><tr class="hit"><td class="line">30</td><td class="hits">4</td><td class="source">    out += '} else if (\n';</td></tr><tr class="hit"><td class="line">31</td><td class="hits">4</td><td class="source">    out += '  (function () {\n';</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">33</td><td class="hits">4</td><td class="source">    _.each(args, function (token) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">10</td><td class="source">      if (token.hasOwnProperty('preout') &amp;&amp; token.preout) {</td></tr><tr class="hit"><td class="line">35</td><td class="hits">7</td><td class="source">        out += token.preout + '\n';</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">39</td><td class="hits">4</td><td class="source">    out += 'return (\n';</td></tr><tr class="hit"><td class="line">40</td><td class="hits">4</td><td class="source">    _.each(args, function (token) {</td></tr><tr class="hit"><td class="line">41</td><td class="hits">10</td><td class="source">      out += token.value + ' ';</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">    });</td></tr><tr class="hit"><td class="line">43</td><td class="hits">4</td><td class="source">    out += ');\n';</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">45</td><td class="hits">4</td><td class="source">    out += '  })()\n';</td></tr><tr class="hit"><td class="line">46</td><td class="hits">4</td><td class="source">    out += ') {\n';</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">48</td><td class="hits">4</td><td class="source">    return out;</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">51</td><td class="hits">6</td><td class="source">  return indent + '\n} else {\n';</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/extends.js">/lib/tags/extends.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * extends</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">module.exports = {};</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/filter.js">/lib/tags/filter.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">9</div><div class="hits">9</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var helpers = require('../helpers'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  _ = require('underscore');</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * filter</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">module.exports = function (indent, parser) {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">6</td><td class="source">  var thisArgs = _.clone(this.args),</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    name = thisArgs.shift(),</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">    args = (thisArgs.length) ? thisArgs.join(', ') : '',</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">    value = '(function () {\n';</td></tr><tr class="hit"><td class="line">12</td><td class="hits">6</td><td class="source">  value += '  var _output = &quot;&quot;;\n';</td></tr><tr class="hit"><td class="line">13</td><td class="hits">6</td><td class="source">  value += parser.compile.apply(this, [indent + '  ']) + '\n';</td></tr><tr class="hit"><td class="line">14</td><td class="hits">6</td><td class="source">  value += '  return _output;\n';</td></tr><tr class="hit"><td class="line">15</td><td class="hits">6</td><td class="source">  value += '})()\n';</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">6</td><td class="source">  return '_output += ' + helpers.wrapFilter(value.replace(/\n/g, ''), { name: name, args: args }) + ';\n';</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">module.exports.ends = true;</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/for.js">/lib/tags/for.js</h2><div id="stats" class="high"><div class="percentage">83%</div><div class="sloc">12</div><div class="hits">10</div><div class="misses">2</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var helpers = require('../helpers'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  _ = require('underscore');</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source">* for</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">*/</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">module.exports = function (indent, parser) {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">17</td><td class="source">  var thisArgs = _.clone(this.args),</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    operand1 = thisArgs[0],</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">    operator = thisArgs[1],</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">    operand2 = parser.parseVariable(thisArgs[2]),</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">    out = '',</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">    loopShared;</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">15</td><td class="hits">17</td><td class="source">  indent = indent || '';</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">17</td><td class="source">  if (typeof operator !== 'undefined' &amp;&amp; operator !== 'in') {</td></tr><tr class="miss"><td class="line">18</td><td class="hits">0</td><td class="source">    throw new Error('Invalid syntax in &quot;for&quot; tag');</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">17</td><td class="source">  if (!helpers.isValidShortName(operand1)) {</td></tr><tr class="miss"><td class="line">22</td><td class="hits">0</td><td class="source">    throw new Error('Invalid arguments (' + operand1 + ') passed to &quot;for&quot; tag');</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">25</td><td class="hits">17</td><td class="source">  loopShared = 'loop.index = __loopIndex + 1;\n' +</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">    'loop.index0 = __loopIndex;\n' +</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">    'loop.revindex = __loopLength - loop.index0;\n' +</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">    'loop.revindex0 = loop.revindex - 1;\n' +</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">    'loop.first = (__loopIndex === 0);\n' +</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">    'loop.last = (__loopIndex === __loopLength - 1);\n' +</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    '_context[&quot;' + operand1 + '&quot;] = __loopIter[loop.key];\n' +</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">    parser.compile.apply(this, [indent + '   ']);</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">34</td><td class="hits">16</td><td class="source">  out = '(function () {\n' +</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">    '  var loop = {}, __loopKey, __loopIndex = 0, __loopLength = 0, __keys = [],' +</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">    '    __ctx_operand = _context[&quot;' + operand1 + '&quot;],\n' +</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">    '    loop_cycle = function() {\n' +</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">    '      var args = _.toArray(arguments), i = loop.index0 % args.length;\n' +</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">    '      return args[i];\n' +</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">    '    };\n' +</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">    helpers.setVar('__loopIter', operand2) +</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">    '  else {\n' +</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">    '    return;\n' +</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">    '  }\n' +</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">    // Basic for loops are MUCH faster than for...in. Prefer this arrays.</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    '  if (_.isArray(__loopIter)) {\n' +</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">    '    __loopIndex = 0; __loopLength = __loopIter.length;\n' +</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">    '    for (; __loopIndex &lt; __loopLength; __loopIndex += 1) {\n' +</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">    '       loop.key = __loopIndex;\n' +</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">    loopShared +</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">    '    }\n' +</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">    '  } else if (typeof __loopIter === &quot;object&quot;) {\n' +</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">    '    __keys = _.keys(__loopIter);\n' +</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">    '    __loopLength = __keys.length;\n' +</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">    '    __loopIndex = 0;\n' +</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">    '    for (; __loopIndex &lt; __loopLength; __loopIndex += 1) {\n' +</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">    '       loop.key = __keys[__loopIndex];\n' +</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">    loopShared +</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">    '    }\n' +</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">    '  }\n' +</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">    '  _context[&quot;' + operand1 + '&quot;] = __ctx_operand;\n' +</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">    '})();\n';</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">64</td><td class="hits">16</td><td class="source">  return out;</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">66</td><td class="hits">1</td><td class="source">module.exports.ends = true;</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/if.js">/lib/tags/if.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">15</div><div class="hits">15</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var helpers = require('../helpers'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  _ = require('underscore');</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * if</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">module.exports = function (indent, parser) {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">39</td><td class="source">  var thisArgs = _.clone(this.args),</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    args = (helpers.parseIfArgs(thisArgs, parser)),</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">    out = '(function () {\n';</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">35</td><td class="source">  _.each(args, function (token) {</td></tr><tr class="hit"><td class="line">13</td><td class="hits">93</td><td class="source">    if (token.hasOwnProperty('preout') &amp;&amp; token.preout) {</td></tr><tr class="hit"><td class="line">14</td><td class="hits">54</td><td class="source">      out += token.preout + '\n';</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">18</td><td class="hits">35</td><td class="source">  out += '\nif (\n';</td></tr><tr class="hit"><td class="line">19</td><td class="hits">35</td><td class="source">  _.each(args, function (token) {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">93</td><td class="source">    out += token.value + ' ';</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  });</td></tr><tr class="hit"><td class="line">22</td><td class="hits">35</td><td class="source">  out += ') {\n';</td></tr><tr class="hit"><td class="line">23</td><td class="hits">35</td><td class="source">  out += parser.compile.apply(this, [indent + '  ']);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">35</td><td class="source">  out += '\n}\n';</td></tr><tr class="hit"><td class="line">25</td><td class="hits">35</td><td class="source">  out += '})();\n';</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">27</td><td class="hits">35</td><td class="source">  return out;</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">module.exports.ends = true;</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/import.js">/lib/tags/import.js</h2><div id="stats" class="high"><div class="percentage">76%</div><div class="sloc">13</div><div class="hits">10</div><div class="misses">3</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var helpers = require('../helpers'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  _ = require('underscore');</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * import</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">module.exports = function (indent, parser) {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">4</td><td class="source">  if (this.args.length !== 3) {</td></tr><tr class="miss"><td class="line">9</td><td class="hits">0</td><td class="source">    throw new Error('Import statements require three arguments: {% import [template] as [context] %}.');</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">4</td><td class="source">  var thisArgs = _.clone(this.args),</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">    file = thisArgs[0],</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">    as = thisArgs[1],</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">    name = thisArgs[2],</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">    out = '';</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">18</td><td class="hits">4</td><td class="source">  if (!helpers.isLiteral(file) &amp;&amp; !helpers.isValidName(file)) {</td></tr><tr class="miss"><td class="line">19</td><td class="hits">0</td><td class="source">    throw new Error('Invalid attempt to import &quot;' + file  + '&quot;.');</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">4</td><td class="source">  if (as !== 'as') {</td></tr><tr class="miss"><td class="line">23</td><td class="hits">0</td><td class="source">    throw new Error('Invalid syntax {% import &quot;' + file + '&quot; ' + as + ' ' + name + ' %}');</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">26</td><td class="hits">4</td><td class="source">  out += '_.extend(_context, (function () {\n';</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">28</td><td class="hits">4</td><td class="source">  out += 'var _context = {}, __ctx = {}, _output = &quot;&quot;;\n' +</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">    helpers.setVar('__template', parser.parseVariable(file)) +</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">    '_this.compileFile(__template).render(__ctx, _parents);\n' +</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    '_.each(__ctx, function (item, key) {\n' +</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">    '  if (typeof item === &quot;function&quot;) {\n' +</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">    '    _context[&quot;' + name + '_&quot; + key] = item;\n' +</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">    '  }\n' +</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">    '});\n' +</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">    'return _context;\n';</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">38</td><td class="hits">4</td><td class="source">  out += '})());\n';</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">40</td><td class="hits">4</td><td class="source">  return out;</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/include.js">/lib/tags/include.js</h2><div id="stats" class="high"><div class="percentage">93%</div><div class="sloc">32</div><div class="hits">30</div><div class="misses">2</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var helpers = require('../helpers'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  _ = require('underscore');</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * include</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">module.exports = function (indent, parser) {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">11</td><td class="source">  var args = _.clone(this.args),</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    template = args.shift(),</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">    context = '_context',</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">    ignore = false,</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">    out = '',</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">    ctx;</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">15</td><td class="hits">11</td><td class="source">  indent = indent || '';</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">11</td><td class="source">  if (!helpers.isLiteral(template) &amp;&amp; !helpers.isValidName(template)) {</td></tr><tr class="miss"><td class="line">18</td><td class="hits">0</td><td class="source">    throw new Error('Invalid arguments passed to \'include\' tag.');</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">11</td><td class="source">  if (args.length) {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">5</td><td class="source">    if (_.last(args) === 'only') {</td></tr><tr class="hit"><td class="line">23</td><td class="hits">2</td><td class="source">      context = '{}';</td></tr><tr class="hit"><td class="line">24</td><td class="hits">2</td><td class="source">      args.pop();</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">27</td><td class="hits">5</td><td class="source">    if (args.length &gt; 1 &amp;&amp; args[0] === 'ignore' &amp; args[1] === 'missing') {</td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">      args.shift();</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">      args.shift();</td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">      ignore = true;</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">33</td><td class="hits">5</td><td class="source">    if (args.length &amp;&amp; args[0] !== 'with') {</td></tr><tr class="miss"><td class="line">34</td><td class="hits">0</td><td class="source">      throw new Error('Invalid arguments passed to \'include\' tag.');</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">37</td><td class="hits">5</td><td class="source">    if (args[0] === 'with') {</td></tr><tr class="hit"><td class="line">38</td><td class="hits">3</td><td class="source">      args.shift();</td></tr><tr class="hit"><td class="line">39</td><td class="hits">3</td><td class="source">      if (!args.length) {</td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">        throw new Error('Context for \'include\' tag not provided, but expected after \'with\' token.');</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">43</td><td class="hits">2</td><td class="source">      ctx = args.shift();</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">45</td><td class="hits">2</td><td class="source">      context = '_context[&quot;' + ctx + '&quot;] || ' + ctx;</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">49</td><td class="hits">10</td><td class="source">  out = '(function () {\n' +</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">    helpers.setVar('__template', parser.parseVariable(template)) + '\n' +</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">    '  var includeContext = ' + context + ';\n';</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">53</td><td class="hits">10</td><td class="source">  if (ignore) {</td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">    out += 'try {\n';</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">57</td><td class="hits">10</td><td class="source">  out += '  if (typeof __template === &quot;string&quot;) {\n';</td></tr><tr class="hit"><td class="line">58</td><td class="hits">10</td><td class="source">  out += '    _output += _this.compileFile(__template).render(includeContext, _parents);\n';</td></tr><tr class="hit"><td class="line">59</td><td class="hits">10</td><td class="source">  out += '  }\n';</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">61</td><td class="hits">10</td><td class="source">  if (ignore) {</td></tr><tr class="hit"><td class="line">62</td><td class="hits">1</td><td class="source">    out += '} catch (e) {}\n';</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">  }</td></tr><tr class="hit"><td class="line">64</td><td class="hits">10</td><td class="source">  out += '})();\n';</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">66</td><td class="hits">10</td><td class="source">  return out;</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/macro.js">/lib/tags/macro.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">12</div><div class="hits">12</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var _ = require('underscore');</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * macro</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">module.exports = function (indent, parser) {</td></tr><tr class="hit"><td class="line">7</td><td class="hits">11</td><td class="source">  var thisArgs = _.clone(this.args),</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">    macro = thisArgs.shift(),</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    args = '',</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">    out = '';</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">11</td><td class="source">  if (thisArgs.length) {</td></tr><tr class="hit"><td class="line">13</td><td class="hits">5</td><td class="source">    args = JSON.stringify(thisArgs).replace(/^\[|\'|\&quot;|\]$/g, '');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">16</td><td class="hits">11</td><td class="source">  out += '_context.' + macro + ' = function (' + args + ') {\n';</td></tr><tr class="hit"><td class="line">17</td><td class="hits">11</td><td class="source">  out += '  var _output = &quot;&quot;;\n';</td></tr><tr class="hit"><td class="line">18</td><td class="hits">11</td><td class="source">  out += parser.compile.apply(this, [indent + '  ']);</td></tr><tr class="hit"><td class="line">19</td><td class="hits">11</td><td class="source">  out += '  return _output;\n';</td></tr><tr class="hit"><td class="line">20</td><td class="hits">11</td><td class="source">  out += '};\n';</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">11</td><td class="source">  return out;</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">};</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">module.exports.ends = true;</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/parent.js">/lib/tags/parent.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">* parent</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">*/</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">module.exports = {};</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/raw.js">/lib/tags/raw.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">1</div><div class="hits">1</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * raw</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">module.exports = { ends: true };</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/set.js">/lib/tags/set.js</h2><div id="stats" class="high"><div class="percentage">90%</div><div class="sloc">10</div><div class="hits">9</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var helpers = require('../helpers'),</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">  _ = require('underscore');</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * set</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">module.exports = function (indent, parser) {</td></tr><tr class="hit"><td class="line">8</td><td class="hits">24</td><td class="source">  var thisArgs = _.clone(this.args),</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    varname = helpers.escapeVarName(thisArgs.shift(), '_context'),</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">    value;</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">  // remove '='</td></tr><tr class="hit"><td class="line">13</td><td class="hits">24</td><td class="source">  if (thisArgs.shift() !== '=') {</td></tr><tr class="miss"><td class="line">14</td><td class="hits">0</td><td class="source">    throw new Error('Invalid token &quot;' + thisArgs[1] + '&quot; in {% set ' + thisArgs[0] + ' %}. Missing &quot;=&quot;.');</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">24</td><td class="source">  value = thisArgs[0];</td></tr><tr class="hit"><td class="line">18</td><td class="hits">24</td><td class="source">  if (helpers.isLiteral(value) || (/^\{|^\[/).test(value) || value === 'true' || value === 'false') {</td></tr><tr class="hit"><td class="line">19</td><td class="hits">20</td><td class="source">    return ' ' + varname + ' = ' + value + ';';</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">4</td><td class="source">  value = parser.parseVariable(value);</td></tr><tr class="hit"><td class="line">23</td><td class="hits">4</td><td class="source">  return ' ' + varname + ' = ' +</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">    '(function () {\n' +</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    '  var _output;\n' +</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">    parser.compile.apply({ tokens: [value] }, [indent]) + '\n' +</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">    '  return _output;\n' +</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">    '})();\n';</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/lib/tags/spaceless.js">/lib/tags/spaceless.js</h2><div id="stats" class="low"><div class="percentage">28%</div><div class="sloc">7</div><div class="hits">2</div><div class="misses">5</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * spaceless</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">module.exports = function (indent, parser) {</td></tr><tr class="miss"><td class="line">5</td><td class="hits">0</td><td class="source">	var output = [],</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">		i = this.tokens.length - 1;</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">8</td><td class="hits">0</td><td class="source">	for (i; i &gt;= 0; i -= 1) {</td></tr><tr class="miss"><td class="line">9</td><td class="hits">0</td><td class="source">		this.tokens[i] = this.tokens[i]</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">			.replace(/^\s+/gi, &quot;&quot;) // trim leading white-space</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">			.replace(/&gt;\s+&lt;/gi,  &quot;&gt;&lt;&quot;) // trim white-space between tags</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">			.replace(/\s+$/gi, &quot;&quot;); // trim trailing white-space</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">15</td><td class="hits">0</td><td class="source">	output.push(parser.compile.call(this, indent + '    '));</td></tr><tr class="miss"><td class="line">16</td><td class="hits">0</td><td class="source">	return output.join('');</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">module.exports.ends = true;</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div></div></div></body></html>
